
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>Conditional Average Treatment Effects (CATE) with DoWhy and EconML &#8212; DoWhy  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mediation analysis with DoWhy: Direct and Indirect Effects" href="dowhy_mediation_analysis.html" />
    <link rel="prev" title="DoWhy: Interpreters for Causal Estimators" href="dowhy_interpreter.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    <img src="../_static/dowhy-logo-small.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/dowhy-logo-small.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="nb_index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dowhy.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../code_repo.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        main
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introductory examples
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_simple_example.html">
   Basic Example for Calculating the Causal Effect
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_basic_example.html">
   Basic Example for Graphical Causal Model-Based Intervention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_confounder_example.html">
   Confounding Example: Finding causal effects from observed data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_estimation_methods.html">
   DoWhy: Different estimation methods for causal inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_interpreter.html">
   DoWhy: Interpreters for Causal Estimators
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Conditional Average Treatment Effects (CATE) with DoWhy and EconML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_mediation_analysis.html">
   Mediation analysis with DoWhy: Direct and Indirect Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_refuter_notebook.html">
   Iterating over multiple refutation tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_causal_api.html">
   Demo for the DoWhy causal API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="do_sampler_demo.html">
   Do-sampler Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Real world-inspired examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">
   Exploring Causes of Hotel Booking Cancellations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_example_effect_of_memberrewards_program.html">
   Estimating the Effect of a Member Rewards Program
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_rca_microservice_architecture.html">
   Finding the Root Cause of Elevated Latencies in a Microservice Architecture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_401k_analysis.html">
   Impact of 401(k) eligibility on net financial assets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_supply_chain_dist_change.html">
   Finding Root Causes of Changes in a Supply Chain
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_counterfactual_medical_dry_eyes.html">
   Counterfactual Analysis in a Medical Case
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Examples on benchmarks datasets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_ihdp_data_example.html">
   DoWhy example on ihdp (Infant Health and Development Program) dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_lalonde_example.html">
   DoWhy example on the Lalonde dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_refutation_testing.html">
   Applying refutation tests to the Lalonde and IHDP datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_401k_analysis.html">
   Impact of 401(k) eligibility on net financial assets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lalonde_pandas_api.html">
   Lalonde Pandas API Example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="load_graph_example.html">
   Different ways to load an input graph
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gcm_draw_samples.html">
   Basic Example for generating samples from a GCM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy-simple-iv-example.html">
   Simple example on using Instrumental Variables method for estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="graph_conditional_independence_refuter.html">
   Testing Assumptions in model with DoWhy: A simple example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_demo_dummy_outcome_refuter.html">
   A Simple Example on Creating a Custom Refutation Using User-Defined Outcome Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dowhy_multiple_treatments.html">
   Estimating effect of multiple treatments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="identifying_effects_using_id_algorithm.html">
   Identifying Effect using ID Algorithm
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Linear-Model">
   Linear Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#EconML-methods">
   EconML methods
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#CATE-Object-and-Confidence-Intervals">
     CATE Object and Confidence Intervals
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Can-provide-a-new-inputs-as-target-units-and-estimate-CATE-on-them.">
     Can provide a new inputs as target units and estimate CATE on them.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Can-also-retrieve-the-raw-EconML-estimator-object-for-any-further-operations">
     Can also retrieve the raw EconML estimator object for any further operations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Works-with-any-EconML-method">
   Works with any EconML method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Binary-treatment,-Binary-outcome">
     Binary treatment, Binary outcome
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Using-DRLearner-estimator">
       Using DRLearner estimator
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Instrumental-Variable-Method">
     Instrumental Variable Method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Metalearners">
     Metalearners
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Avoiding-retraining-the-estimator">
   Avoiding retraining the estimator
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Refuting-the-estimate">
   Refuting the estimate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-a-random-common-cause-variable">
     Adding a random common cause variable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-an-unobserved-common-cause-variable">
     Adding an unobserved common cause variable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Replacing-treatment-with-a-random-(placebo)-variable">
     Replacing treatment with a random (placebo) variable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Removing-a-random-subset-of-the-data">
     Removing a random subset of the data
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Conditional-Average-Treatment-Effects-(CATE)-with-DoWhy-and-EconML">
<h1>Conditional Average Treatment Effects (CATE) with DoWhy and EconML<a class="headerlink" href="#Conditional-Average-Treatment-Effects-(CATE)-with-DoWhy-and-EconML" title="Permalink to this heading"></a></h1>
<p>This is an experimental feature where we use <a class="reference external" href="https://github.com/microsoft/econml">EconML</a> methods from DoWhy. Using EconML allows CATE estimation using different methods.</p>
<p>All four steps of causal inference in DoWhy remain the same: model, identify, estimate, and refute. The key difference is that we now call econml methods in the estimation step. There is also a simpler example using linear regression to understand the intuition behind CATE estimators.</p>
<p>All datasets are generated using linear structural equations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%load_ext autoreload
%autoreload 2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd
import logging

import dowhy
from dowhy import CausalModel
import dowhy.datasets

import econml
import warnings
warnings.filterwarnings(&#39;ignore&#39;)

BETA = 10
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data = dowhy.datasets.linear_dataset(BETA, num_common_causes=4, num_samples=10000,
                                    num_instruments=2, num_effect_modifiers=2,
                                     num_treatments=1,
                                    treatment_is_binary=False,
                                    num_discrete_common_causes=2,
                                    num_discrete_effect_modifiers=0,
                                    one_hot_encode=False)
df=data[&#39;df&#39;]
print(df.head())
print(&quot;True causal estimate is&quot;, data[&quot;ate&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
         X0        X1   Z0        Z1        W0        W1 W2 W3         v0  \
0 -1.413410 -1.758856  1.0  0.039353  0.003886  1.514089  3  1  27.923544
1  0.021769 -0.250640  1.0  0.130985  1.832770 -1.189097  1  2  30.263870
2 -2.986704 -0.089114  1.0  0.815246  1.238494 -0.244607  0  1  28.071940
3  0.856564 -0.087727  1.0  0.340249 -0.723452 -2.578047  1  2  19.389127
4 -0.207446  0.607456  1.0  0.104319 -0.763529 -1.261459  2  3  27.893087

            y
0  -58.413151
1  275.170875
2    8.921308
3  225.835853
4  338.961826
True causal estimate is 6.992357725373975
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = CausalModel(data=data[&quot;df&quot;],
                    treatment=data[&quot;treatment_name&quot;], outcome=data[&quot;outcome_name&quot;],
                    graph=data[&quot;gml_graph&quot;])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.view_model()
from IPython.display import Image, display
display(Image(filename=&quot;causal_model.png&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy-conditional-treatment-effects_5_0.png" src="../_images/example_notebooks_dowhy-conditional-treatment-effects_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>identified_estimand= model.identify_effect(proceed_when_unidentifiable=True)
print(identified_estimand)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

### Estimand : 2
Estimand name: iv
Estimand expression:
 ⎡                              -1⎤
 ⎢    d        ⎛    d          ⎞  ⎥
E⎢─────────(y)⋅⎜─────────([v₀])⎟  ⎥
 ⎣d[Z₁  Z₀]    ⎝d[Z₁  Z₀]      ⎠  ⎦
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!

</pre></div></div>
</div>
<section id="Linear-Model">
<h2>Linear Model<a class="headerlink" href="#Linear-Model" title="Permalink to this heading"></a></h2>
<p>First, let us build some intuition using a linear model for estimating CATE. The effect modifiers (that lead to a heterogeneous treatment effect) can be modeled as interaction terms with the treatment. Thus, their value modulates the effect of treatment.</p>
<p>Below the estimated effect of changing treatment from 0 to 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>linear_estimate = model.estimate_effect(identified_estimand,
                                        method_name=&quot;backdoor.linear_regression&quot;,
                                       control_value=0,
                                       treatment_value=1)
print(linear_estimate)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

## Realized estimand
b: y~v0+W0+W1+W2+W3+v0*X1+v0*X0
Target units: ate

## Estimate
Mean value: 6.99254703861277

</pre></div></div>
</div>
</section>
<section id="EconML-methods">
<h2>EconML methods<a class="headerlink" href="#EconML-methods" title="Permalink to this heading"></a></h2>
<p>We now move to the more advanced methods from the EconML package for estimating CATE.</p>
<p>First, let us look at the double machine learning estimator. Method_name corresponds to the fully qualified name of the class that we want to use. For double ML, it is “econml.dml.DML”.</p>
<p>Target units defines the units over which the causal estimate is to be computed. This can be a lambda function filter on the original dataframe, a new Pandas dataframe, or a string corresponding to the three main kinds of target units (“ate”, “att” and “atc”). Below we show an example of a lambda function.</p>
<p>Method_params are passed directly to EconML. For details on allowed parameters, refer to the EconML documentation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LassoCV
from sklearn.ensemble import GradientBoostingRegressor
dml_estimate = model.estimate_effect(identified_estimand, method_name=&quot;backdoor.econml.dml.DML&quot;,
                                     control_value = 0,
                                     treatment_value = 1,
                                 target_units = lambda df: df[&quot;X0&quot;]&gt;1,  # condition used for CATE
                                 confidence_intervals=False,
                                method_params={&quot;init_params&quot;:{&#39;model_y&#39;:GradientBoostingRegressor(),
                                                              &#39;model_t&#39;: GradientBoostingRegressor(),
                                                              &quot;model_final&quot;:LassoCV(fit_intercept=False),
                                                              &#39;featurizer&#39;:PolynomialFeatures(degree=1, include_bias=False)},
                                               &quot;fit_params&quot;:{}})
print(dml_estimate)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

## Realized estimand
b: y~v0+W0+W1+W2+W3 | X1,X0
Target units: Data subset defined by a function

## Estimate
Mean value: 13.152516013567084
Effect estimates: [[10.45462316]
 [10.69869237]
 [16.9324957 ]
 [14.82648162]
 [ 7.00814573]
 [ 8.06820317]
 [13.91881256]
 [15.22865385]
 [ 7.80169964]
 [ 6.06610201]
 [19.09752976]
 [15.09410275]
 [10.884093  ]
 [12.14928704]
 [18.75139082]
 [12.76972127]
 [13.73520328]
 [13.77535238]
 [19.19331064]
 [10.41973244]
 [17.78777669]
 [ 8.26668976]
 [11.92705162]
 [24.09502459]
 [14.13077002]
 [12.89837354]
 [14.42634568]
 [18.53250654]
 [ 9.02316474]
 [ 4.50553429]
 [ 7.92036563]
 [14.74458303]
 [12.39329421]
 [ 6.76051701]
 [11.33649912]
 [15.13271628]
 [15.60061863]
 [13.23435498]
 [20.75917591]
 [11.19236012]
 [13.39588978]
 [17.39708161]
 [ 4.86319678]
 [ 2.20910301]
 [14.22217988]
 [10.35849118]
 [ 4.66543589]
 [14.79842359]
 [12.19157286]
 [ 8.89608306]
 [11.04946123]
 [17.53972775]
 [ 5.36855683]
 [11.15119872]
 [ 7.48240834]
 [18.84278751]
 [ 7.27498159]
 [19.31459344]
 [12.89510554]
 [ 9.58795983]
 [12.96959699]
 [20.48643553]
 [ 5.86217963]
 [ 7.11990408]
 [14.40469143]
 [ 2.56281803]
 [17.95578193]
 [13.27355279]
 [12.44797225]
 [16.89694952]
 [19.41878008]
 [11.60318633]
 [15.20980029]
 [10.90107087]
 [16.85970729]
 [22.86429839]
 [10.66371297]
 [11.18038044]
 [14.97526476]
 [16.38195312]
 [ 5.0570308 ]
 [12.49447562]
 [10.51064628]
 [13.15916452]
 [14.18749644]
 [15.17224466]
 [15.16415182]
 [16.33421807]
 [11.8039843 ]
 [ 9.5110857 ]
 [ 9.19635189]
 [17.84800764]
 [13.18048953]
 [10.61096433]
 [ 8.07679035]
 [21.65684841]
 [18.89714036]
 [14.79596491]
 [17.19668471]
 [27.80872913]
 [16.27093556]
 [12.55203328]
 [13.49567659]
 [21.15046701]
 [11.49954539]
 [ 5.8755565 ]
 [ 9.86747653]
 [13.10923437]
 [18.94104843]
 [17.39140877]
 [ 9.75527927]
 [16.09095727]
 [13.67553221]
 [19.96936177]
 [ 8.58319631]
 [16.06276582]
 [17.36463085]
 [12.31626421]
 [13.77093677]
 [ 5.50323691]
 [ 8.57020248]
 [13.18962443]
 [14.41338599]
 [15.35667552]
 [20.07415021]
 [14.93666108]
 [20.14658234]
 [20.64234692]
 [21.33948091]
 [10.89653133]
 [ 6.88053472]
 [ 7.84685026]
 [17.45791777]
 [13.2286289 ]
 [ 9.26499934]
 [ 5.30358415]
 [12.05795866]
 [21.04419948]
 [ 7.09605135]
 [ 8.65902467]
 [13.51477886]
 [13.26646103]
 [17.78153875]
 [13.20856157]
 [ 9.04319763]
 [13.88496586]
 [12.31171549]
 [ 1.12266322]
 [11.07071109]
 [13.00303433]
 [12.69307672]
 [25.27754871]
 [12.03577418]
 [ 5.99067618]
 [13.86184914]
 [11.94257807]
 [ 8.28273752]
 [ 9.56776712]
 [16.12233289]
 [ 9.7574179 ]
 [ 9.04073849]
 [13.086546  ]
 [ 9.68546057]
 [21.22053541]
 [11.14480127]
 [ 4.71525059]
 [13.23846062]
 [18.73574756]
 [18.35266565]
 [29.07443263]
 [15.95250943]
 [18.54106411]
 [ 8.49285644]
 [ 3.41509023]
 [ 8.17412227]
 [15.90854733]
 [13.92640774]
 [14.45943024]
 [16.61441144]
 [ 8.53836731]
 [15.01250267]
 [ 9.04280832]
 [13.21753425]
 [13.08537611]
 [13.18376011]
 [14.49194821]
 [16.58098105]
 [ 9.2965088 ]
 [20.26635979]
 [15.40485045]
 [14.64092627]
 [ 7.92257331]
 [13.7354457 ]
 [ 7.7449272 ]
 [25.99961865]
 [20.44422097]
 [15.87202244]
 [18.3232319 ]
 [11.24790587]
 [ 6.66547117]
 [15.44620741]
 [ 7.7661538 ]
 [15.7163773 ]
 [ 8.2405159 ]
 [16.93286317]
 [ 9.10174414]
 [12.97382912]
 [12.50182238]
 [13.10112026]
 [ 9.80353773]
 [12.70962528]
 [17.12567553]
 [ 3.49932307]
 [14.54720378]
 [12.46708768]
 [21.38329893]
 [ 4.88115499]
 [19.19051219]
 [14.085403  ]
 [18.28940337]
 [16.34377204]
 [12.65702723]
 [13.90085232]
 [ 7.60360357]
 [13.91791899]
 [17.42775873]
 [12.1222463 ]
 [20.57829214]
 [15.34742306]
 [14.42249819]
 [18.00729178]
 [20.4108707 ]
 [24.58549869]
 [21.5327522 ]
 [15.45404419]
 [12.10230801]
 [ 7.99752646]
 [10.26507575]
 [17.00171747]
 [16.92451608]
 [14.89418968]
 [ 8.65585499]
 [14.97011358]
 [ 8.65997706]
 [13.21180292]
 [14.73371089]
 [15.55675568]
 [ 7.02357936]
 [12.98201728]
 [10.707755  ]
 [13.33584257]
 [14.95901041]
 [11.78012501]
 [18.84421703]
 [18.31238047]
 [18.67196382]
 [ 7.73508115]
 [17.30460731]
 [19.01452094]
 [21.68993071]
 [13.25643574]
 [21.26943263]
 [13.50334031]
 [10.16673208]
 [17.15937031]
 [10.30856804]
 [ 9.978258  ]
 [ 5.99423015]
 [14.90605636]
 [20.38990785]
 [ 9.08100936]
 [15.18067031]
 [16.21357651]
 [10.27934389]
 [20.00090557]
 [ 6.06615587]
 [15.83772774]
 [ 7.83821439]
 [10.44611421]
 [16.56443716]
 [15.52857886]
 [11.4889163 ]
 [10.26361251]
 [-0.04114437]
 [11.08782671]
 [12.96737255]
 [10.98975346]
 [15.37581515]
 [10.93281418]
 [16.0419412 ]
 [12.99027955]
 [12.83005732]
 [19.06345449]
 [16.06306576]
 [23.48338528]
 [12.16693508]
 [10.43422977]
 [19.11384932]
 [ 9.92840363]
 [ 9.62747337]
 [ 9.41583979]
 [20.33210575]
 [ 8.61409842]
 [ 6.97138477]
 [10.63039908]
 [16.98654824]
 [ 8.1914969 ]
 [ 8.4426248 ]
 [23.89075791]
 [12.93548758]
 [11.17957546]
 [ 9.20153688]
 [ 5.10375595]
 [12.38733639]
 [ 9.82954115]
 [16.74917574]
 [13.18608444]
 [ 9.63446406]
 [ 2.17605369]
 [13.07387231]
 [12.37310614]
 [ 8.80657007]
 [13.61504047]
 [-2.30846217]
 [ 5.88082448]
 [17.25252359]
 [12.71099609]
 [15.77038303]
 [19.82921034]
 [17.42806658]
 [15.21662198]
 [26.41817627]
 [23.80166573]
 [ 7.97505979]
 [15.90340036]
 [10.07497201]
 [22.49411989]
 [12.63609109]
 [12.04844956]
 [14.99694413]
 [10.57514948]
 [ 5.98700918]
 [13.16188092]
 [21.02608071]
 [19.08951424]
 [23.36189932]
 [11.11138182]
 [14.14178299]
 [ 8.331776  ]
 [17.06537993]
 [19.35996852]
 [12.55953313]
 [10.54866757]
 [13.04218382]
 [17.58172824]
 [ 7.86708521]
 [19.30512597]
 [17.23338904]
 [-0.95678825]
 [17.48232075]
 [14.8060665 ]
 [13.79971957]
 [17.93871013]
 [ 3.53495644]
 [15.02828641]
 [13.27782198]
 [13.07368856]
 [17.76113754]
 [ 8.5868032 ]
 [ 5.07568512]
 [13.77892152]
 [17.49990379]
 [16.99808643]
 [11.15440477]
 [12.98416172]
 [12.10543847]
 [ 5.95045561]
 [11.51364795]
 [13.33379068]
 [11.4564214 ]
 [15.78360834]
 [10.47719785]
 [18.90850424]
 [11.61034189]
 [11.80215573]
 [17.48245796]
 [12.10585749]
 [14.7102681 ]
 [ 0.39482791]
 [17.12460766]
 [11.39964163]
 [ 7.42841135]
 [20.46036482]
 [21.46164459]
 [12.10350758]
 [17.12738005]
 [16.09095412]
 [15.25045746]
 [15.03925841]
 [18.31172016]
 [ 9.400586  ]
 [17.06909285]
 [14.87337242]
 [15.46890041]
 [11.19066862]
 [18.25554541]
 [ 7.20723181]
 [ 6.31796471]
 [11.97832791]
 [ 2.58421805]
 [19.93568347]
 [14.80720311]
 [19.44831373]
 [ 5.9363856 ]
 [10.14401977]
 [27.35431404]
 [15.85571596]
 [21.00124034]
 [ 4.69095166]
 [13.29883623]
 [14.47242243]
 [12.55448619]
 [ 8.70649457]
 [ 9.39320609]
 [11.65516355]
 [10.79017334]
 [15.63120172]
 [12.22528974]
 [20.54056401]
 [14.4715049 ]
 [11.61831471]
 [10.98375542]
 [11.9837053 ]
 [-3.28308333]
 [ 6.76967565]
 [13.6704284 ]
 [15.9838171 ]
 [ 9.53776358]
 [17.44845963]
 [10.7788535 ]
 [17.40501304]
 [14.88843655]
 [15.767788  ]
 [ 0.14817437]
 [13.47878905]
 [ 5.52266923]
 [16.73254218]
 [13.07428118]
 [10.15281663]
 [ 3.616374  ]
 [10.58202192]
 [16.07969127]
 [23.92667273]
 [ 9.40198589]
 [18.4866509 ]
 [10.23321604]
 [22.16474285]
 [ 9.31890926]
 [ 6.74961729]
 [12.44120292]
 [ 9.04301538]
 [13.9243094 ]
 [15.7902301 ]
 [14.50945212]
 [ 4.75812029]
 [10.98037786]
 [17.85216716]
 [ 8.71527461]
 [12.98083514]
 [23.72982616]
 [18.88801907]
 [22.90636047]
 [ 9.05123213]
 [15.33201544]
 [14.64388153]
 [ 3.43410504]
 [16.56023036]
 [17.51019252]
 [17.33695654]
 [10.16139513]
 [ 8.51252428]
 [13.31086314]
 [ 9.91803348]
 [11.00387399]
 [16.23504757]
 [18.27774848]
 [16.76000545]
 [ 9.43293084]
 [ 5.4123143 ]
 [13.19150051]
 [10.81139214]
 [ 4.3336649 ]
 [11.32346192]
 [15.24055586]
 [11.97048926]
 [21.62152217]
 [17.77857071]
 [ 5.34625781]
 [14.87857802]
 [ 9.53583725]
 [ 9.45728278]
 [15.79119239]
 [13.06792552]
 [23.04182189]
 [14.2478058 ]
 [19.48144323]
 [18.40625276]
 [17.59568772]
 [ 8.41946957]
 [13.95468651]
 [16.97027633]
 [22.88281176]
 [ 7.18590221]
 [ 7.62958127]
 [11.10087413]
 [14.85048248]
 [14.39450629]
 [10.9312715 ]
 [ 5.16100953]
 [14.51042412]
 [14.33807007]
 [ 4.18288796]
 [14.30300486]
 [11.57934693]
 [11.55049632]
 [ 9.70176323]
 [ 9.38030829]
 [13.46231323]
 [15.6070381 ]
 [25.96151662]
 [18.81526278]
 [17.92723397]
 [ 9.67100984]
 [13.4983838 ]
 [16.96175305]
 [10.40999391]
 [12.60149223]
 [18.16103026]
 [ 8.54575486]
 [12.97647185]
 [ 6.34105434]
 [24.92326046]
 [19.5074779 ]
 [ 7.23265491]
 [ 5.83560069]
 [11.16737009]
 [10.59648345]
 [ 5.54482169]
 [19.47331776]
 [ 8.11286835]
 [ 4.06545393]
 [28.14236972]
 [11.05129186]
 [10.98193218]
 [11.48261666]
 [14.70779189]
 [17.64717408]
 [13.12583984]
 [ 1.8459703 ]
 [ 4.00346934]
 [17.96153807]
 [14.58621045]
 [ 6.65182531]
 [18.66948915]
 [ 6.98979553]
 [10.87055032]
 [ 6.09419476]
 [ 0.41718153]
 [ 8.74002923]
 [15.04523186]
 [14.9567123 ]
 [ 7.84474674]
 [21.41745919]
 [ 2.23332629]
 [ 7.50715584]
 [12.74521716]
 [ 5.60497585]
 [11.0489259 ]
 [ 7.08368006]
 [15.46326491]
 [15.22474785]
 [11.63525296]
 [24.75237889]
 [ 9.77071687]
 [17.22664782]
 [17.70312069]
 [12.16537924]
 [13.70406229]
 [ 0.26817099]
 [17.37731614]
 [10.9412516 ]
 [ 7.51320059]
 [18.65832624]
 [ 7.75782845]
 [20.78253878]
 [ 8.16755803]
 [ 3.1329759 ]
 [ 9.88430841]
 [ 7.03847101]
 [ 7.40275225]
 [ 9.98598501]
 [ 8.89937449]
 [10.22375311]
 [18.84133219]
 [19.19093   ]
 [22.36795545]
 [18.52205663]
 [10.77596547]
 [14.82278616]
 [16.19508824]
 [ 9.0231657 ]
 [14.21927648]
 [14.1769838 ]
 [15.43883232]
 [14.26412799]
 [23.73046693]
 [20.18382926]
 [10.78655136]
 [ 6.28545695]
 [15.52349006]
 [19.16735325]
 [13.47248224]
 [20.55877516]
 [16.04019813]
 [10.66968595]
 [17.01129691]
 [16.12651889]
 [11.60830386]
 [15.75422563]
 [10.96978533]
 [10.31199818]
 [21.70330323]
 [12.95273011]
 [12.07320651]
 [10.82844798]
 [11.88633262]
 [14.36379635]
 [ 6.04682519]
 [11.93817044]
 [18.54977071]
 [ 6.53202145]
 [10.96515845]
 [16.92594195]
 [18.23925072]
 [12.73106886]
 [ 4.46252401]
 [17.4976957 ]
 [15.75457349]
 [17.2584471 ]
 [12.41858134]
 [ 5.64511256]
 [29.08755615]
 [21.78625182]
 [ 6.63913233]
 [13.99961306]
 [ 6.76463523]
 [17.03639906]
 [10.94480806]
 [18.07220068]
 [12.0039034 ]
 [13.31472994]
 [ 9.36918772]
 [20.55217568]
 [ 6.11049129]
 [ 8.32203033]
 [ 6.36134179]
 [16.63232515]
 [14.60920831]
 [10.49887783]
 [10.88453997]
 [14.97175887]
 [12.87448296]
 [15.76636294]
 [20.36423952]
 [11.82623861]
 [ 9.279281  ]
 [14.68714351]
 [14.7554547 ]
 [15.02144137]
 [19.4637447 ]
 [22.30910737]
 [ 9.18789473]
 [ 5.28268552]
 [16.23463321]
 [ 8.90705462]
 [12.13166036]
 [ 8.80274633]
 [ 9.69758708]
 [ 7.56295351]
 [10.66692881]
 [ 5.45874154]
 [20.5150445 ]
 [11.42759072]
 [20.38594394]
 [10.2259887 ]
 [17.41432862]
 [ 7.12911773]
 [ 9.75125351]
 [10.90708837]
 [20.03805297]
 [16.64201041]
 [10.735234  ]
 [12.26084717]
 [16.45121629]
 [15.47753704]
 [18.07456835]
 [14.11986139]
 [15.26370656]
 [18.88642292]
 [ 9.55844991]
 [16.02071647]
 [ 8.6025101 ]
 [11.61174149]
 [11.77109465]
 [23.51327706]
 [15.1517811 ]
 [ 8.44412377]
 [13.0471202 ]
 [ 7.69433543]
 [ 8.9459437 ]
 [15.26916363]
 [17.59407558]
 [12.28137248]
 [ 5.05473111]
 [ 5.76296327]
 [12.57635324]
 [10.9144893 ]
 [16.95921146]
 [17.63086785]
 [16.66979825]
 [16.96655249]
 [12.88833656]
 [15.33654597]
 [ 7.9820883 ]
 [ 8.95407984]
 [11.65874176]
 [11.5801167 ]
 [ 9.78636797]
 [12.53980177]
 [11.4571953 ]
 [15.98499022]
 [18.83549329]
 [10.78179143]
 [ 5.37312545]
 [ 5.86274754]
 [17.09631483]]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;True causal estimate is&quot;, data[&quot;ate&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True causal estimate is 6.992357725373975
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dml_estimate = model.estimate_effect(identified_estimand, method_name=&quot;backdoor.econml.dml.DML&quot;,
                                     control_value = 0,
                                     treatment_value = 1,
                                 target_units = 1,  # condition used for CATE
                                 confidence_intervals=False,
                                method_params={&quot;init_params&quot;:{&#39;model_y&#39;:GradientBoostingRegressor(),
                                                              &#39;model_t&#39;: GradientBoostingRegressor(),
                                                              &quot;model_final&quot;:LassoCV(fit_intercept=False),
                                                              &#39;featurizer&#39;:PolynomialFeatures(degree=1, include_bias=True)},
                                               &quot;fit_params&quot;:{}})
print(dml_estimate)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

## Realized estimand
b: y~v0+W0+W1+W2+W3 | X1,X0
Target units:

## Estimate
Mean value: 6.858018924354772
Effect estimates: [[-3.15356393]
 [ 8.81456988]
 [-0.24120027]
 ...
 [ 8.9458857 ]
 [-3.98728915]
 [ 4.94218312]]

</pre></div></div>
</div>
<section id="CATE-Object-and-Confidence-Intervals">
<h3>CATE Object and Confidence Intervals<a class="headerlink" href="#CATE-Object-and-Confidence-Intervals" title="Permalink to this heading"></a></h3>
<p>EconML provides its own methods to compute confidence intervals. Using BootstrapInference in the example below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LassoCV
from sklearn.ensemble import GradientBoostingRegressor
from econml.inference import BootstrapInference
dml_estimate = model.estimate_effect(identified_estimand,
                                     method_name=&quot;backdoor.econml.dml.DML&quot;,
                                     target_units = &quot;ate&quot;,
                                     confidence_intervals=True,
                                     method_params={&quot;init_params&quot;:{&#39;model_y&#39;:GradientBoostingRegressor(),
                                                              &#39;model_t&#39;: GradientBoostingRegressor(),
                                                              &quot;model_final&quot;: LassoCV(fit_intercept=False),
                                                              &#39;featurizer&#39;:PolynomialFeatures(degree=1, include_bias=True)},
                                               &quot;fit_params&quot;:{
                                                               &#39;inference&#39;: BootstrapInference(n_bootstrap_samples=100, n_jobs=-1),
                                                            }
                                              })
print(dml_estimate)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

## Realized estimand
b: y~v0+W0+W1+W2+W3 | X1,X0
Target units: ate

## Estimate
Mean value: 6.919875742160713
Effect estimates: [[-3.06651487]
 [ 8.89603504]
 [-0.31238944]
 ...
 [ 8.94293373]
 [-3.86170882]
 [ 5.05898611]]

</pre></div></div>
</div>
</section>
<section id="Can-provide-a-new-inputs-as-target-units-and-estimate-CATE-on-them.">
<h3>Can provide a new inputs as target units and estimate CATE on them.<a class="headerlink" href="#Can-provide-a-new-inputs-as-target-units-and-estimate-CATE-on-them." title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_cols= data[&#39;effect_modifier_names&#39;] # only need effect modifiers&#39; values
test_arr = [np.random.uniform(0,1, 10) for _ in range(len(test_cols))] # all variables are sampled uniformly, sample of 10
test_df = pd.DataFrame(np.array(test_arr).transpose(), columns=test_cols)
dml_estimate = model.estimate_effect(identified_estimand,
                                     method_name=&quot;backdoor.econml.dml.DML&quot;,
                                     target_units = test_df,
                                     confidence_intervals=False,
                                     method_params={&quot;init_params&quot;:{&#39;model_y&#39;:GradientBoostingRegressor(),
                                                              &#39;model_t&#39;: GradientBoostingRegressor(),
                                                              &quot;model_final&quot;:LassoCV(),
                                                              &#39;featurizer&#39;:PolynomialFeatures(degree=1, include_bias=True)},
                                               &quot;fit_params&quot;:{}
                                              })
print(dml_estimate.cate_estimates)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[12.71893755]
 [15.98112765]
 [13.79717877]
 [11.49870459]
 [13.20844069]
 [11.7981185 ]
 [16.54024983]
 [14.12602546]
 [14.14926521]
 [13.61644329]]
</pre></div></div>
</div>
</section>
<section id="Can-also-retrieve-the-raw-EconML-estimator-object-for-any-further-operations">
<h3>Can also retrieve the raw EconML estimator object for any further operations<a class="headerlink" href="#Can-also-retrieve-the-raw-EconML-estimator-object-for-any-further-operations" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(dml_estimate._estimator_object)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;econml.dml.dml.DML object at 0x7f31553b01c0&gt;
</pre></div></div>
</div>
</section>
</section>
<section id="Works-with-any-EconML-method">
<h2>Works with any EconML method<a class="headerlink" href="#Works-with-any-EconML-method" title="Permalink to this heading"></a></h2>
<p>In addition to double machine learning, below we example analyses using orthogonal forests, DRLearner (bug to fix), and neural network-based instrumental variables.</p>
<section id="Binary-treatment,-Binary-outcome">
<h3>Binary treatment, Binary outcome<a class="headerlink" href="#Binary-treatment,-Binary-outcome" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data_binary = dowhy.datasets.linear_dataset(BETA, num_common_causes=4, num_samples=10000,
                                    num_instruments=2, num_effect_modifiers=2,
                                    treatment_is_binary=True, outcome_is_binary=True)
# convert boolean values to {0,1} numeric
data_binary[&#39;df&#39;].v0 = data_binary[&#39;df&#39;].v0.astype(int)
data_binary[&#39;df&#39;].y = data_binary[&#39;df&#39;].y.astype(int)
print(data_binary[&#39;df&#39;])

model_binary = CausalModel(data=data_binary[&quot;df&quot;],
                    treatment=data_binary[&quot;treatment_name&quot;], outcome=data_binary[&quot;outcome_name&quot;],
                    graph=data_binary[&quot;gml_graph&quot;])
identified_estimand_binary = model_binary.identify_effect(proceed_when_unidentifiable=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
            X0        X1   Z0        Z1        W0        W1        W2  \
0    -0.660682 -2.048445  1.0  0.955939  0.826712  0.764124 -0.607382
1    -2.225708 -1.068361  1.0  0.638313  0.832868 -0.461534 -1.295342
2    -0.417930 -0.596783  1.0  0.983176 -0.562417  0.645023 -0.977009
3     0.054642 -0.752604  1.0  0.798751  2.002079 -0.617171  1.476514
4     1.232192 -0.454198  1.0  0.267086  1.864127 -0.250061 -0.470017
...        ...       ...  ...       ...       ...       ...       ...
9995  0.120610 -2.393805  1.0  0.316355  1.172240 -0.213649  0.263738
9996 -1.805804  0.170793  1.0  0.318291  0.045085 -1.406779  0.597025
9997 -1.346753 -0.100624  1.0  0.935095  1.330017 -0.198791  0.191091
9998  0.261920 -3.470132  1.0  0.765593 -0.831872  0.179312  0.280275
9999 -0.283981  0.361993  1.0  0.920268  0.138731  0.793740 -1.529829

            W3  v0  y
0     2.741209   1  1
1    -1.664641   1  0
2     0.220389   1  1
3     1.064324   1  1
4     2.106588   1  1
...        ...  .. ..
9995 -1.483179   1  1
9996  1.263891   1  1
9997 -0.790396   1  0
9998  0.165502   1  1
9999  1.987221   1  1

[10000 rows x 10 columns]
</pre></div></div>
</div>
<section id="Using-DRLearner-estimator">
<h4>Using DRLearner estimator<a class="headerlink" href="#Using-DRLearner-estimator" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.linear_model import LogisticRegressionCV
#todo needs binary y
drlearner_estimate = model_binary.estimate_effect(identified_estimand_binary,
                                method_name=&quot;backdoor.econml.dr.LinearDRLearner&quot;,
                                confidence_intervals=False,
                                method_params={&quot;init_params&quot;:{
                                                    &#39;model_propensity&#39;: LogisticRegressionCV(cv=3, solver=&#39;lbfgs&#39;, multi_class=&#39;auto&#39;)
                                                    },
                                               &quot;fit_params&quot;:{}
                                              })
print(drlearner_estimate)
print(&quot;True causal estimate is&quot;, data_binary[&quot;ate&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W2,W3,U) = P(y|v0,W0,W1,W2,W3)

## Realized estimand
b: y~v0+W0+W1+W2+W3 | X1,X0
Target units: ate

## Estimate
Mean value: 0.6385873397251924
Effect estimates: [[0.58634098]
 [0.5318715 ]
 [0.64296366]
 ...
 [0.60806806]
 [0.59310059]
 [0.67894666]]

True causal estimate is 0.1471
</pre></div></div>
</div>
</section>
</section>
<section id="Instrumental-Variable-Method">
<h3>Instrumental Variable Method<a class="headerlink" href="#Instrumental-Variable-Method" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import keras
dims_zx = len(model.get_instruments())+len(model.get_effect_modifiers())
dims_tx = len(model._treatment)+len(model.get_effect_modifiers())
treatment_model = keras.Sequential([keras.layers.Dense(128, activation=&#39;relu&#39;, input_shape=(dims_zx,)), # sum of dims of Z and X
                                    keras.layers.Dropout(0.17),
                                    keras.layers.Dense(64, activation=&#39;relu&#39;),
                                    keras.layers.Dropout(0.17),
                                    keras.layers.Dense(32, activation=&#39;relu&#39;),
                                    keras.layers.Dropout(0.17)])
response_model = keras.Sequential([keras.layers.Dense(128, activation=&#39;relu&#39;, input_shape=(dims_tx,)), # sum of dims of T and X
                                    keras.layers.Dropout(0.17),
                                    keras.layers.Dense(64, activation=&#39;relu&#39;),
                                    keras.layers.Dropout(0.17),
                                    keras.layers.Dense(32, activation=&#39;relu&#39;),
                                    keras.layers.Dropout(0.17),
                                    keras.layers.Dense(1)])

deepiv_estimate = model.estimate_effect(identified_estimand,
                                        method_name=&quot;iv.econml.iv.nnet.DeepIV&quot;,
                                        target_units = lambda df: df[&quot;X0&quot;]&gt;-1,
                                        confidence_intervals=False,
                                method_params={&quot;init_params&quot;:{&#39;n_components&#39;: 10, # Number of gaussians in the mixture density networks
                                                              &#39;m&#39;: lambda z, x: treatment_model(keras.layers.concatenate([z, x])), # Treatment model,
                                                              &quot;h&quot;: lambda t, x: response_model(keras.layers.concatenate([t, x])), # Response model
                                                              &#39;n_samples&#39;: 1, # Number of samples used to estimate the response
                                                              &#39;first_stage_options&#39;: {&#39;epochs&#39;:25},
                                                              &#39;second_stage_options&#39;: {&#39;epochs&#39;:25}
                                                             },
                                               &quot;fit_params&quot;:{}})
print(deepiv_estimate)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-12-09 13:17:37.233524: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-12-09 13:17:37.370165: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2022-12-09 13:17:37.370208: I tensorflow/compiler/xla/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
2022-12-09 13:17:38.142065: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory
2022-12-09 13:17:38.142216: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory
2022-12-09 13:17:38.142228: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
2022-12-09 13:17:39.058519: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcuda.so.1&#39;; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2022-12-09 13:17:39.058552: W tensorflow/compiler/xla/stream_executor/cuda/cuda_driver.cc:265] failed call to cuInit: UNKNOWN ERROR (303)
2022-12-09 13:17:39.058577: I tensorflow/compiler/xla/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (35131d426759): /proc/driver/nvidia/version does not exist
2022-12-09 13:17:39.059067: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/25
313/313 [==============================] - 2s 2ms/step - loss: 10.3947
Epoch 2/25
313/313 [==============================] - 1s 2ms/step - loss: 3.7979
Epoch 3/25
313/313 [==============================] - 1s 2ms/step - loss: 3.0799
Epoch 4/25
313/313 [==============================] - 1s 2ms/step - loss: 2.9517
Epoch 5/25
313/313 [==============================] - 1s 2ms/step - loss: 2.8812
Epoch 6/25
313/313 [==============================] - 1s 2ms/step - loss: 2.8545
Epoch 7/25
313/313 [==============================] - 1s 2ms/step - loss: 2.8186
Epoch 8/25
313/313 [==============================] - 1s 2ms/step - loss: 2.7959
Epoch 9/25
313/313 [==============================] - 1s 2ms/step - loss: 2.7833
Epoch 10/25
313/313 [==============================] - 1s 2ms/step - loss: 2.7582
Epoch 11/25
313/313 [==============================] - 1s 2ms/step - loss: 2.7502
Epoch 12/25
313/313 [==============================] - 1s 2ms/step - loss: 2.7298
Epoch 13/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6937
Epoch 14/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6845
Epoch 15/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6676
Epoch 16/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6647
Epoch 17/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6664
Epoch 18/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6576
Epoch 19/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6591
Epoch 20/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6544
Epoch 21/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6550
Epoch 22/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6481
Epoch 23/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6418
Epoch 24/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6478
Epoch 25/25
313/313 [==============================] - 1s 2ms/step - loss: 2.6379
Epoch 1/25
313/313 [==============================] - 3s 2ms/step - loss: 29299.5566
Epoch 2/25
313/313 [==============================] - 1s 2ms/step - loss: 12392.2520
Epoch 3/25
313/313 [==============================] - 1s 2ms/step - loss: 10040.9453
Epoch 4/25
313/313 [==============================] - 1s 2ms/step - loss: 9209.0215
Epoch 5/25
313/313 [==============================] - 1s 2ms/step - loss: 8983.1143
Epoch 6/25
313/313 [==============================] - 1s 2ms/step - loss: 8955.3818
Epoch 7/25
313/313 [==============================] - 1s 2ms/step - loss: 9041.1035
Epoch 8/25
313/313 [==============================] - 1s 2ms/step - loss: 8886.7744
Epoch 9/25
313/313 [==============================] - 1s 2ms/step - loss: 8666.0986
Epoch 10/25
313/313 [==============================] - 1s 2ms/step - loss: 8714.7949
Epoch 11/25
313/313 [==============================] - 1s 2ms/step - loss: 8780.4775
Epoch 12/25
313/313 [==============================] - 1s 2ms/step - loss: 8739.3174
Epoch 13/25
313/313 [==============================] - 1s 2ms/step - loss: 8772.6641
Epoch 14/25
313/313 [==============================] - 1s 2ms/step - loss: 8719.2129
Epoch 15/25
313/313 [==============================] - 1s 2ms/step - loss: 8875.8145
Epoch 16/25
313/313 [==============================] - 1s 2ms/step - loss: 8847.7139
Epoch 17/25
313/313 [==============================] - 1s 2ms/step - loss: 8937.2881
Epoch 18/25
313/313 [==============================] - 1s 2ms/step - loss: 9008.7930
Epoch 19/25
313/313 [==============================] - 1s 2ms/step - loss: 8659.9668
Epoch 20/25
313/313 [==============================] - 1s 2ms/step - loss: 8696.4580
Epoch 21/25
313/313 [==============================] - 1s 2ms/step - loss: 8793.9385
Epoch 22/25
313/313 [==============================] - 1s 2ms/step - loss: 8806.3330
Epoch 23/25
313/313 [==============================] - 1s 2ms/step - loss: 8716.0010
Epoch 24/25
313/313 [==============================] - 1s 2ms/step - loss: 8688.5234
Epoch 25/25
313/313 [==============================] - 1s 2ms/step - loss: 8874.3262
WARNING:tensorflow:
The following Variables were used a Lambda layer&#39;s call (lambda_7), but
are not present in its tracked objects:
  &lt;tf.Variable &#39;dense_3/kernel:0&#39; shape=(3, 128) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_3/bias:0&#39; shape=(128,) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_4/kernel:0&#39; shape=(128, 64) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_4/bias:0&#39; shape=(64,) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_5/kernel:0&#39; shape=(64, 32) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_5/bias:0&#39; shape=(32,) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_6/kernel:0&#39; shape=(32, 1) dtype=float32&gt;
  &lt;tf.Variable &#39;dense_6/bias:0&#39; shape=(1,) dtype=float32&gt;
It is possible that this is intended behavior, but it is more likely
an omission. This is a strong indication that this layer should be
formulated as a subclassed Layer rather than a Lambda layer.
220/220 [==============================] - 0s 913us/step
220/220 [==============================] - 0s 926us/step
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: iv
Estimand expression:
 ⎡                              -1⎤
 ⎢    d        ⎛    d          ⎞  ⎥
E⎢─────────(y)⋅⎜─────────([v₀])⎟  ⎥
 ⎣d[Z₁  Z₀]    ⎝d[Z₁  Z₀]      ⎠  ⎦
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W0+W1+W2+W3 | X1,X0
Target units: Data subset defined by a function

## Estimate
Mean value: 3.049394369125366
Effect estimates: [[4.2145386]
 [4.3873596]
 [4.3264313]
 ...
 [4.2678833]
 [3.719345 ]
 [2.6655731]]

</pre></div></div>
</div>
</section>
<section id="Metalearners">
<h3>Metalearners<a class="headerlink" href="#Metalearners" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data_experiment = dowhy.datasets.linear_dataset(BETA, num_common_causes=5, num_samples=10000,
                                    num_instruments=2, num_effect_modifiers=5,
                                    treatment_is_binary=True, outcome_is_binary=False)
# convert boolean values to {0,1} numeric
data_experiment[&#39;df&#39;].v0 = data_experiment[&#39;df&#39;].v0.astype(int)
print(data_experiment[&#39;df&#39;])
model_experiment = CausalModel(data=data_experiment[&quot;df&quot;],
                    treatment=data_experiment[&quot;treatment_name&quot;], outcome=data_experiment[&quot;outcome_name&quot;],
                    graph=data_experiment[&quot;gml_graph&quot;])
identified_estimand_experiment = model_experiment.identify_effect(proceed_when_unidentifiable=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
            X0        X1        X2        X3        X4   Z0        Z1  \
0     0.227583  0.613611 -0.624349 -0.099415 -1.499853  0.0  0.383725
1     1.149086 -1.705130 -0.071666  1.368312  0.608030  0.0  0.883908
2     0.156221 -0.028727 -0.323037  2.605388 -0.746350  0.0  0.405649
3     0.329450 -1.644618  1.926032  1.377526 -1.176076  0.0  0.659795
4    -0.006760 -0.481071  0.267069  0.644782  0.864703  0.0  0.759197
...        ...       ...       ...       ...       ...  ...       ...
9995  1.788413  0.305520 -1.162477 -0.053043  0.826269  1.0  0.112045
9996 -0.975469 -1.131830  1.336772  0.750373  2.453931  0.0  0.463394
9997  0.595296 -0.244005  1.784113  1.809114 -0.324531  0.0  0.608878
9998  1.234208 -1.655754 -1.205274  2.920235  0.480335  1.0  0.922281
9999 -0.234767 -0.517918  1.218605  0.548685  2.024372  0.0  0.604203

            W0        W1        W2        W3        W4  v0          y
0     0.159549  1.051563  2.773713  0.851324 -0.972989   1   9.607935
1     1.209543 -0.363065  0.631430  0.554213  0.097160   1  23.307049
2    -0.124670 -0.613430  1.255303  1.974037 -0.143739   1  18.511698
3     0.775392  1.317528 -0.588630  1.099245  0.451014   1  23.317546
4     0.370328 -1.410862  0.454504  0.559156 -1.060690   0  -5.765340
...        ...       ...       ...       ...       ...  ..        ...
9995 -0.661035 -0.927430  1.789781  1.110612 -0.328514   1  18.366270
9996 -1.127131 -1.432917  0.722855  1.394507 -0.063615   0  -5.214954
9997 -0.005383  2.837457 -1.507911  3.580316  0.282231   1  43.595298
9998 -1.505211 -0.114911  2.342867  0.830447 -0.425451   1  24.256791
9999  1.579851 -0.894285  0.264174  0.571652 -0.005327   1  21.550251

[10000 rows x 14 columns]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.ensemble import RandomForestRegressor
metalearner_estimate = model_experiment.estimate_effect(identified_estimand_experiment,
                                method_name=&quot;backdoor.econml.metalearners.TLearner&quot;,
                                confidence_intervals=False,
                                method_params={&quot;init_params&quot;:{
                                                    &#39;models&#39;: RandomForestRegressor()
                                                    },
                                               &quot;fit_params&quot;:{}
                                              })
print(metalearner_estimate)
print(&quot;True causal estimate is&quot;, data_experiment[&quot;ate&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W4,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W4,W2,W3,U) = P(y|v0,W0,W1,W4,W2,W3)

## Realized estimand
b: y~v0+X1+X4+X2+X3+X0+W0+W1+W4+W2+W3
Target units: ate

## Estimate
Mean value: 20.619502141782416
Effect estimates: [[ 5.79709054]
 [23.77190973]
 [17.47058258]
 ...
 [31.76404351]
 [28.13878646]
 [21.8156199 ]]

True causal estimate is 17.75545946133507
</pre></div></div>
</div>
</section>
</section>
<section id="Avoiding-retraining-the-estimator">
<h2>Avoiding retraining the estimator<a class="headerlink" href="#Avoiding-retraining-the-estimator" title="Permalink to this heading"></a></h2>
<p>Once an estimator is fitted, it can be reused to estimate effect on different data points. In this case, you can pass <code class="docutils literal notranslate"><span class="pre">fit_estimator=False</span></code> to <code class="docutils literal notranslate"><span class="pre">estimate_effect</span></code>. This works for any EconML estimator. We show an example for the T-learner below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># For metalearners, need to provide all the features (except treatmeant and outcome)
metalearner_estimate = model_experiment.estimate_effect(identified_estimand_experiment,
                                method_name=&quot;backdoor.econml.metalearners.TLearner&quot;,
                                confidence_intervals=False,
                                fit_estimator=False,
                                target_units=data_experiment[&quot;df&quot;].drop([&quot;v0&quot;,&quot;y&quot;, &quot;Z0&quot;, &quot;Z1&quot;], axis=1)[9995:],
                                method_params={})
print(metalearner_estimate)
print(&quot;True causal estimate is&quot;, data_experiment[&quot;ate&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W1,W4,W2,W3])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W1,W4,W2,W3,U) = P(y|v0,W0,W1,W4,W2,W3)

## Realized estimand
b: y~v0+X1+X4+X2+X3+X0+W0+W1+W4+W2+W3
Target units: Data subset provided as a data frame

## Estimate
Mean value: 24.911132292802293
Effect estimates: [[22.78236846]
 [20.05484313]
 [31.76404351]
 [28.13878646]
 [21.8156199 ]]

True causal estimate is 17.75545946133507
</pre></div></div>
</div>
</section>
<section id="Refuting-the-estimate">
<h2>Refuting the estimate<a class="headerlink" href="#Refuting-the-estimate" title="Permalink to this heading"></a></h2>
<section id="Adding-a-random-common-cause-variable">
<h3>Adding a random common cause variable<a class="headerlink" href="#Adding-a-random-common-cause-variable" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_random=model.refute_estimate(identified_estimand, dml_estimate, method_name=&quot;random_common_cause&quot;)
print(res_random)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Add a random common cause
Estimated effect:13.743449153183866
New effect:13.79707117850077
p value:0.52

</pre></div></div>
</div>
</section>
<section id="Adding-an-unobserved-common-cause-variable">
<h3>Adding an unobserved common cause variable<a class="headerlink" href="#Adding-an-unobserved-common-cause-variable" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_unobserved=model.refute_estimate(identified_estimand, dml_estimate, method_name=&quot;add_unobserved_common_cause&quot;,
                                     confounders_effect_on_treatment=&quot;linear&quot;, confounders_effect_on_outcome=&quot;linear&quot;,
                                    effect_strength_on_treatment=0.01, effect_strength_on_outcome=0.02)
print(res_unobserved)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Add an Unobserved Common Cause
Estimated effect:13.743449153183866
New effect:13.731372186270296

</pre></div></div>
</div>
</section>
<section id="Replacing-treatment-with-a-random-(placebo)-variable">
<h3>Replacing treatment with a random (placebo) variable<a class="headerlink" href="#Replacing-treatment-with-a-random-(placebo)-variable" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_placebo=model.refute_estimate(identified_estimand, dml_estimate,
        method_name=&quot;placebo_treatment_refuter&quot;, placebo_type=&quot;permute&quot;,
        num_simulations=10 # at least 100 is good, setting to 10 for speed
        )
print(res_placebo)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Use a Placebo Treatment
Estimated effect:13.743449153183866
New effect:0.04391840702724602
p value:0.3694413401817636

</pre></div></div>
</div>
</section>
<section id="Removing-a-random-subset-of-the-data">
<h3>Removing a random subset of the data<a class="headerlink" href="#Removing-a-random-subset-of-the-data" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_subset=model.refute_estimate(identified_estimand, dml_estimate,
        method_name=&quot;data_subset_refuter&quot;, subset_fraction=0.8,
        num_simulations=10)
print(res_subset)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Use a subset of data
Estimated effect:13.743449153183866
New effect:13.799026147285456
p value:0.34079605961356974

</pre></div></div>
</div>
<p>More refutation methods to come, especially specific to the CATE estimators.</p>
</section>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="dowhy_interpreter.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">DoWhy: Interpreters for Causal Estimators</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="dowhy_mediation_analysis.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Mediation analysis with DoWhy: Direct and Indirect Effects</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PyWhy contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>