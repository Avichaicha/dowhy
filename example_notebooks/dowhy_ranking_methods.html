<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ranking of estimation methods for a given dataset &mdash; DoWhy | An end-to-end library for causal inference  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DoWhy | An end-to-end library for causal inference
          </a>
              <div class="version">
                0.7.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introducing DoWhy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">DoWhy | An end-to-end library for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#graphical-models-and-potential-outcomes-best-of-both-worlds">Graphical Models and Potential Outcomes: Best of both worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#four-steps-of-causal-inference">Four steps of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#citing-this-package">Citing this package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#roadmap">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#contributing">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick-Start Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial-causalinference-machinelearning-using-dowhy-econml.html">Tutorial on Causal Inference and its Connections to Machine Learning (Using DoWhy+EconML)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Starter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dowhy_simple_example.html">Getting started with DoWhy: A simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_confounder_example.html">Confounding Example: Finding causal effects from observed data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_estimation_methods.html">DoWhy: Different estimation methods for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy-simple-iv-example.html">Simple example on using Instrumental Variables method for estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_graph_example.html">Different ways to load an input graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_interpreter.html">DoWhy: Interpreters for Causal Estimators</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_api.html">Demo for the DoWhy causal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="do_sampler_demo.html">Do-sampler Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case Study Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">DoWhy-The Causal Story Behind Hotel Booking Cancellations</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_example_effect_of_memberrewards_program.html">Estimating the effect of a Member Rewards program</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_ihdp_data_example.html">DoWhy example on ihdp (Infant Health and Development Program) dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_twins_example.html">DoWhy example on Twins dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_lalonde_example.html">DoWhy example on the Lalonde dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_refutation_testing.html">Applying refutation tests to the Lalonde and IHDP datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="lalonde_pandas_api.html">Lalonde Pandas API Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dowhy-conditional-treatment-effects.html">Conditional Average Treatment Effects (CATE) with DoWhy and EconML</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_mediation_analysis.html">Mediation analysis with DoWhy: Direct and Indirect Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_demo_dummy_outcome_refuter.html">A Simple Example on Creating a Custom Refutation Using User-Defined Outcome Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_multiple_treatments.html">Estimating effect of multiple treatments</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_refuter_notebook.html">Iterating over multiple refutation tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html">Causal Discovery example</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Experiments-on-the-Auto-MPG-dataset">Experiments on the Auto-MPG dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Causal-Discovery-with-Causal-Discovery-Tool-(CDT)">Causal Discovery with Causal Discovery Tool (CDT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Experiments-on-the-Sachs-dataset">Experiments on the Sachs dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#id2">Causal Discovery with Causal Discovery Tool (CDT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="identifying_effects_using_id_algorithm.html">Identifying Effect using ID Algorithm</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GCM-based inference (Experimental)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gcm/user_guide/index.html">GCMs User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcm_basic_example.html">Basic Example for GCM-Based Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="rca_microservice_architecture.html">Root cause analysis (RCA) of latencies in a microservice architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy.html">dowhy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DoWhy | An end-to-end library for causal inference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Ranking of estimation methods for a given dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_notebooks/dowhy_ranking_methods.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Ranking-of-estimation-methods-for-a-given-dataset">
<h1>Ranking of estimation methods for a given dataset<a class="headerlink" href="#Ranking-of-estimation-methods-for-a-given-dataset" title="Permalink to this headline"></a></h1>
<p>We illustrate the comparison of various estimation methods for a given datasets by ranking them according to their performance against refutation tests accounting for both the observed unmodelled confounding error and unobserved confounding error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing all the required libraries</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">xgboost</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegressionCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="kn">import</span> <span class="nn">dowhy</span>
<span class="kn">from</span> <span class="nn">dowhy.utils</span> <span class="kn">import</span> <span class="n">dgp</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.dgps.linear_dgp</span> <span class="kn">import</span> <span class="n">LinearDataGeneratingProcess</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_refuters.add_unobserved_common_cause</span> <span class="kn">import</span> <span class="n">AddUnobservedCommonCause</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">mtransforms</span>

<span class="c1"># Config dict to set the logging level</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
<span class="n">DEFAULT_LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;WARN&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">DEFAULT_LOGGING</span><span class="p">)</span>
<span class="c1"># Disabling warnings output</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">DataConversionWarning</span><span class="p">,</span> <span class="n">ConvergenceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">DataConversionWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import MultiIndex, Int64Index
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_singleton_to_float</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Helper function.&#39;&#39;&#39;</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This script only accepts one value for the refute&quot;</span><span class="p">)</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">array</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ensure_dir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<span class="n">RESULTSFOLDER</span> <span class="o">=</span> <span class="s2">&quot;results/&quot;</span>
<span class="n">ensure_dir</span><span class="p">(</span><span class="n">RESULTSFOLDER</span><span class="p">)</span>
<span class="c1"># Create the estimator named tuple to wrap the name and properties</span>
<span class="n">Estimator</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Estimator&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>
<span class="n">Refuter</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Refuter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">Experiment</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to define the experiment setup to compare a list of estimators across a list of refuters for the given dataset.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;experiment_name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_experiments</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;num_experiments&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sample_sizes&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dgps&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;estimators&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;refuters&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;simulate_unobserved_confounding&quot;</span><span class="p">]</span>

        <span class="c1"># Handle input errors in sample_sizes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;sample_sizes&quot; should be an int or a list&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">]</span>

        <span class="c1"># Handle input errors in DGPs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">,</span> <span class="n">DataGeneratingProcess</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;dgps&quot; should be a list or a subclass of &quot;DataGeneratingProcess&quot;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">]</span>

        <span class="c1"># Handle inputs errors in estimators</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">,</span> <span class="n">Estimator</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;estimators&quot; should be a list or an Estimator namedtuple&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">]</span>

        <span class="c1"># Handle input errors in refuters</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">,</span> <span class="n">Refuter</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;refuters&quot; should be a list of a Refuter namedtuple&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running Experiment:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_experiments</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running Experiment Number:&quot;</span><span class="p">,</span><span class="n">exp</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">sample_size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">:</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Current Sample Size:&quot;</span><span class="p">,</span><span class="n">sample_size</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">dgp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">The current DGP:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">dgp</span><span class="p">)</span>
                    <span class="n">estimates</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">estimate_values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">estimated_effect</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">new_effect</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">p_value</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">generate_data</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing data shape&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">dgp</span><span class="o">.</span><span class="n">true_value</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dgp</span><span class="o">.</span><span class="n">treatment_is_binary</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
                    <span class="c1">#k = len(dgp.confounder)-4</span>
                    <span class="c1">#confounder_list = random.sample(dgp.confounder, k)</span>
                    <span class="n">confounder_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w2&#39;</span><span class="p">,</span><span class="s1">&#39;w3&#39;</span><span class="p">]</span>


                    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">confounder_list</span><span class="p">)</span>
                    <span class="n">unobserved_confounders</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dgp</span><span class="o">.</span><span class="n">confounder</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
                    <span class="n">df_unobserved_confounders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unobserved_confounders</span><span class="p">]])</span>

                    <span class="n">df_unobserved_confounders</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;results/unobserved_confounders.csv&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing length of confounder list:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">confounder_list</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing confounder list:&quot;</span><span class="p">,</span> <span class="n">confounder_list</span><span class="p">)</span>



                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data columns&quot;</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data columns&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                        <span class="n">treatment</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
                        <span class="n">outcome</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                        <span class="n">common_causes</span> <span class="o">=</span> <span class="n">confounder_list</span><span class="p">,</span>
                        <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">effect_modifier</span>
                    <span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">view_model</span><span class="p">()</span>
                    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;causal_model.png&quot;</span><span class="p">))</span>

                    <span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">(</span><span class="n">proceed_when_unidentifiable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;identified_estimand:&quot;</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">)</span>
                    <span class="c1">#print(&quot;identified_estimand:&quot;, identified_estimand)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running the estimators:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The current estimator:&quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimator.params&quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                        <span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
                            <span class="n">identified_estimand</span><span class="p">,</span>
                            <span class="n">method_name</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">method_params</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">params</span>
                        <span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing estimate&#39;s type&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">estimate</span><span class="p">))</span>
                        <span class="n">estimates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span>
                        <span class="n">estimate_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">estimate_values</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">estimate_values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimate_values&quot;</span><span class="p">,</span> <span class="n">estimate_values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running the refuters:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">refuter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The current refuter:&quot;</span><span class="p">,</span> <span class="n">refuter</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">estimate</span> <span class="ow">in</span> <span class="n">estimates</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_unobserved_confounding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;********</span><span class="si">%%%%%%%%</span><span class="s2">%$$$$$&amp;&amp;^**^^^^*^*^*&quot;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">:</span>
                                    <span class="n">add_unobserved_confounder</span> <span class="o">=</span> <span class="n">AddUnobservedCommonCause</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;add_unobserved_confounder&quot;</span><span class="p">,</span> <span class="n">add_unobserved_confounder</span><span class="p">)</span>
                                    <span class="n">unobserved_confounder_values</span> <span class="o">=</span> <span class="n">add_unobserved_confounder</span><span class="o">.</span><span class="n">include_simulated_confounder</span><span class="p">(</span><span class="n">convergence_threshold</span> <span class="o">=</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">c_star_max</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">)</span>
                                    <span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;unobserved_confounder_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unobserved_confounder_values</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refuter.params&#39;</span><span class="p">,</span> <span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                            <span class="n">refute</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span>
                                <span class="n">identified_estimand</span><span class="p">,</span>
                                <span class="n">estimate</span><span class="p">,</span>
                                <span class="n">method_name</span> <span class="o">=</span> <span class="n">refuter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>



                            <span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing refute&#39;s type&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">refute</span><span class="p">))</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">):</span>
                                <span class="n">refute</span> <span class="o">=</span> <span class="n">refute</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">refute</span><span class="o">.</span><span class="n">refutation_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">p_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">refutation_result</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">p_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                            <span class="n">estimated_effect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">estimated_effect</span><span class="p">)</span>
                            <span class="c1">#print(&quot;refute.estimate_effect()&quot;, refute.estimate_effect())</span>
                            <span class="n">new_effect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span><span class="p">)</span>

                    <span class="n">estimated_effect</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">estimated_effect</span><span class="p">)</span>
                    <span class="n">new_effect</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">new_effect</span><span class="p">)</span>
                    <span class="n">p_value</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>
                    <span class="n">true_value</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">dgp</span><span class="o">.</span><span class="n">true_value</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimated effect&quot;</span><span class="p">,</span> <span class="n">estimated_effect</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new_effect&quot;</span><span class="p">,</span> <span class="n">new_effect</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p_value&quot;</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true value&quot;</span><span class="p">,</span> <span class="n">true_value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">dgp</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="o">*</span><span class="n">estimate_values</span><span class="p">,</span> <span class="o">*</span><span class="n">estimated_effect</span><span class="p">,</span> <span class="o">*</span><span class="n">new_effect</span><span class="p">,</span> <span class="o">*</span><span class="n">p_value</span><span class="p">,</span> <span class="n">true_value</span><span class="p">])</span>


        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Completed all experiments. Saving the data...&quot;</span><span class="p">)</span>

        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EXPERIMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_SIZE&#39;</span><span class="p">,</span> <span class="s1">&#39;DGP&#39;</span><span class="p">]</span>
        <span class="n">RESULT_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ESTIMATED_EFFECT&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW_EFFECT&#39;</span><span class="p">,</span> <span class="s1">&#39;P_VALUE&#39;</span><span class="p">]</span>
        <span class="n">estimator_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimator</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">]</span>
        <span class="n">refuter_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">refuter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">estimator_name</span> <span class="ow">in</span> <span class="n">estimator_names</span><span class="p">:</span>
            <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;ORIGINAL_ESTIMATE&#39;</span><span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">estimator_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">result_category</span> <span class="ow">in</span> <span class="n">RESULT_CATEGORIES</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">refuter_name</span> <span class="ow">in</span> <span class="n">refuter_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">estimator_name</span> <span class="ow">in</span> <span class="n">estimator_names</span><span class="p">:</span>
                    <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">refuter_name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">estimator_name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">result_category</span><span class="p">]</span>

        <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;TRUE_VALUE&#39;</span><span class="p">]</span>

        <span class="n">csv_file</span> <span class="o">=</span> <span class="n">RESULTSFOLDER</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;_data.csv&#39;</span>
        <span class="n">onlyres_csv_file</span> <span class="o">=</span> <span class="n">RESULTSFOLDER</span> <span class="o">+</span> <span class="s2">&quot;onlyres_&quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;_data.csv&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data has been saved in &quot;</span><span class="p">,</span><span class="n">csv_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">csv_file</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Defining the Data Generating Process</span>
<span class="n">ldgp</span> <span class="o">=</span> <span class="n">LinearDataGeneratingProcess</span><span class="p">(</span><span class="n">treatment</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">confounder</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;w1&#39;</span><span class="p">,</span><span class="s1">&#39;w2&#39;</span><span class="p">,</span> <span class="s1">&#39;w3&#39;</span><span class="p">,</span><span class="s1">&#39;w4&#39;</span><span class="p">,</span><span class="s1">&#39;w5&#39;</span><span class="p">,</span><span class="s1">&#39;w6&#39;</span><span class="p">],</span> <span class="n">effect_modifier</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Defining the sample size</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">dgp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ldgp&#39;</span><span class="p">:</span><span class="n">ldgp</span><span class="p">}</span>
<span class="n">dgp_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dgp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dgp_dict</span><span class="p">[</span><span class="s1">&#39;ldgp&#39;</span><span class="p">]</span> <span class="p">)</span>


<span class="c1"># Create a namedtuple to store the name of the estimator and the parameters passed</span>
<span class="n">estimator_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backdoor.linear_regression&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.propensity_score_stratification&quot;,</span>
                  <span class="s2">&quot;backdoor.propensity_score_matching&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.propensity_score_weighting&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dml.DML&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dr.LinearDRLearner&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.TLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.XLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.LRSRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.XGBTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.MLPTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.BaseXRegressor&quot;</span>
                <span class="p">]</span>
<span class="n">method_params</span><span class="o">=</span> <span class="p">[</span>    <span class="kc">None</span><span class="p">,</span>
                    <span class="c1">#None,</span>
                    <span class="p">{</span> <span class="s2">&quot;init_params&quot;</span><span class="p">:{}</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&quot;init_params&quot;</span><span class="p">:{}</span> <span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                    <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                    <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                                    <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                     <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}},</span>
                    <span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span> <span class="s1">&#39;model_propensity&#39;</span><span class="p">:</span> <span class="n">LogisticRegressionCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}</span>
                    <span class="p">},</span>
                    <span class="sd">&#39;&#39;&#39;{&quot;init_params&quot;: {&#39;models&#39;: GradientBoostingRegressor(n_estimators=100, max_depth=6, min_samples_leaf=int(sample_size/100))</span>
<span class="sd">                                    },</span>
<span class="sd">                    &quot;fit_params&quot;:{}</span>
<span class="sd">                    },</span>
<span class="sd">                    {&quot;init_params&quot;:{&#39;models&#39;: GradientBoostingRegressor(n_estimators=100, max_depth=6, min_samples_leaf=int(sample_size/100)),</span>
<span class="sd">                        &#39;propensity_model&#39;: RandomForestClassifier(n_estimators=100, max_depth=6,</span>
<span class="sd">                                                                              min_samples_leaf=int(sample_size/100))</span>
<span class="sd">                        },</span>
<span class="sd">                     &quot;fit_params&quot;:{}</span>
<span class="sd">                    },</span>
<span class="sd">                    {&quot;init_params&quot;:{},},</span>
<span class="sd">                    {&quot;init_params&quot;:{</span>
<span class="sd">                        &#39;learner&#39;:XGBRegressor()</span>
<span class="sd">                        }</span>
<span class="sd">                    }&#39;&#39;&#39;</span>
                <span class="p">]</span>
<span class="n">estimator_tuples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">refuter_tuples</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">refuter_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">]</span>
<span class="n">refuter_params</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;num_simulations&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;transformation_list&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;random_forest&#39;</span><span class="p">,{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">})],</span> <span class="s1">&#39;true_causal_effect&#39;</span><span class="p">:(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mf">0.5</span><span class="p">)}]</span>


<span class="c1"># Iterate through the names and parameters to create a list of namedtuples</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span><span class="n">method_params</span><span class="p">):</span>
    <span class="n">estimator_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Estimator</span><span class="o">.</span><span class="n">_make</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">refuter_list</span><span class="p">,</span> <span class="n">refuter_params</span><span class="p">):</span>
    <span class="n">refuter_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Refuter</span><span class="o">.</span><span class="n">_make</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">]))</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="n">true_value_column</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">estimate_columns</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#print(estimate_columns)</span>
    <span class="c1">#print(type(estimate_columns))</span>
    <span class="n">estimate_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">]))</span>
    <span class="c1">#print(estimate_columns)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">MAE</span> <span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">estimate_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ORIGINAL_ESTIMATE:backdoor.propensity_score_weighting&#39;</span><span class="p">,):</span>
                           <span class="c1">#&#39;ORIGINAL_ESTIMATE:backdoor.econml.metalearners.TLearner&#39;):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">colname</span><span class="p">)</span>
            <span class="s2">&quot;Mean Absolute Error (MAE): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">]))</span>
            <span class="n">MAE</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Calibration plot showing the accuracy of different causal estimators [P(T=1)=0.9]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Estimated effect&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True causal effect&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.20</span><span class="p">),</span>
              <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing MAE of various estimates: &quot;</span><span class="p">)</span>
    <span class="n">MAE_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">MAE</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">MAE_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;EXPERIMENT&#39;</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:ESTIMATED_EFFECT&#39;</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span>
    <span class="c1">#print(res[&#39;TRUE_VALUE&#39;])</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;TRUE_VALUE&#39;</span><span class="p">])</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:P_VALUE&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Estimated Effect&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;New Effect&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;True Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;P Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;EXPERIMENT&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;EFFECT&quot;</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">estimator_list</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Observed-unmodelled-confounding-error">
<h1>Observed unmodelled confounding error<a class="headerlink" href="#Observed-unmodelled-confounding-error" title="Permalink to this headline"></a></h1>
<p>For each estimator, we use dummy outcome refuter to check the observed unmodelled confounding error for each estimator. That is, we run the refutation test for each estimator only on the observed confounders and analyse what amount of confounding error is present unmodelled amongst the observed variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the properties of the experiment</span>
<span class="c1"># The name of the experiment</span>
<span class="c1"># The experiment ID</span>
<span class="c1"># The number of experiments to be run with the SAME parameters</span>
<span class="c1"># The size of the samples to be run</span>
<span class="c1"># The list of DGPs to be run</span>
<span class="c1"># The list of estimators</span>
<span class="n">observed_confounding_error</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="n">num_experiments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># 10</span>
    <span class="n">sample_sizes</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
    <span class="n">dgps</span><span class="o">=</span><span class="n">dgp_list</span><span class="p">,</span>
    <span class="n">estimators</span><span class="o">=</span><span class="n">estimator_tuples</span><span class="p">,</span>
    <span class="n">refuters</span><span class="o">=</span><span class="n">refuter_tuples</span><span class="p">,</span>
    <span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">observed_confounding_error</span><span class="o">.</span><span class="n">experiment</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Running Experiment: Test_1


Running Experiment Number: 0


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {}
        bias: {}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.26451385]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w2,w3))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w2,w3,U) = P(y|t1,w2,w3)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
linear_regression
{&#39;control_value&#39;: 0, &#39;treatment_value&#39;: 1, &#39;test_significance&#39;: None, &#39;evaluate_effect_strength&#39;: False, &#39;confidence_intervals&#39;: False, &#39;target_units&#39;: &#39;ate&#39;, &#39;effect_modifiers&#39;: [&#39;x1&#39;, &#39;x2&#39;]}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/1238584747.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span> <span class="ansi-red-fg"># Run the experiment</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg"> </span>res <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_csv<span class="ansi-blue-fg">(</span>observed_confounding_error<span class="ansi-blue-fg">.</span>experiment<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/3365708414.py</span> in <span class="ansi-cyan-fg">experiment</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>                         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;The current estimator:&#34;</span><span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;estimator.params&#34;</span><span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">.</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-fg">                         estimate = model.estimate_effect(
</span><span class="ansi-green-intense-fg ansi-bold">    118</span>                             identified_estimand<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>                             method_name <span class="ansi-blue-fg">=</span> estimator<span class="ansi-blue-fg">.</span>name<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_model.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self, identified_estimand, method_name, control_value, treatment_value, test_significance, evaluate_effect_strength, confidence_intervals, target_units, effect_modifiers, fit_estimator, method_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    314</span>                         target_units)
<span class="ansi-green-intense-fg ansi-bold">    315</span>
<span class="ansi-green-fg">--&gt; 316</span><span class="ansi-red-fg">             </span>estimate <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>causal_estimator<span class="ansi-blue-fg">.</span>estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    317</span>             <span class="ansi-red-fg"># Store parameters inside estimate object for refutation methods</span>
<span class="ansi-green-intense-fg ansi-bold">    318</span>             <span class="ansi-red-fg"># TODO: This add_params needs to move to the estimator class</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimator.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    189</span>         <span class="ansi-blue-fg">:</span>returns<span class="ansi-blue-fg">:</span> A CausalEstimate instance that contains point estimates of average <span class="ansi-green-fg">and</span> conditional effects<span class="ansi-blue-fg">.</span> Based on the parameters provided<span class="ansi-blue-fg">,</span> it optionally includes confidence intervals<span class="ansi-blue-fg">,</span> standard errors<span class="ansi-blue-fg">,</span>statistical significance <span class="ansi-green-fg">and</span> other statistical parameters<span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    190</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 191</span><span class="ansi-red-fg">         </span>est <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span>         est<span class="ansi-blue-fg">.</span>add_estimator<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    193</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect</span><span class="ansi-blue-fg">(self, data_df, need_conditional_estimates)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         conditional_effect_estimates <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">if</span> need_conditional_estimates<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 56</span><span class="ansi-red-fg">             conditional_effect_estimates = self._estimate_conditional_effects(
</span><span class="ansi-green-intense-fg ansi-bold">     57</span>                     self<span class="ansi-blue-fg">.</span>_estimate_effect_fn<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     58</span>                     effect_modifier_names=self._effect_modifier_names)

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_conditional_effects</span><span class="ansi-blue-fg">(self, estimate_effect_fn, effect_modifier_names, num_quantiles)</span>
<span class="ansi-green-intense-fg ansi-bold">    258</span>         by_effect_mods <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_data<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span>effect_modifier_names<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    259</span>         cond_est_fn <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">lambda</span> x<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_treatment_value<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_control_value<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 260</span><span class="ansi-red-fg">         </span>conditional_estimates <span class="ansi-blue-fg">=</span> by_effect_mods<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>estimate_effect_fn<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span>         <span class="ansi-red-fg"># Deleting the temporary categorical columns</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>         <span class="ansi-green-fg">for</span> em <span class="ansi-green-fg">in</span> effect_modifier_names<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">(self, func, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1412</span>         <span class="ansi-green-fg">with</span> option_context<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;mode.chained_assignment&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1413</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1414</span><span class="ansi-red-fg">                 </span>result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_python_apply_general<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_selected_obj<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1415</span>             <span class="ansi-green-fg">except</span> TypeError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1416</span>                 <span class="ansi-red-fg"># gh-20949</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ansi-cyan-fg">_python_apply_general</span><span class="ansi-blue-fg">(self, f, data, not_indexed_same)</span>
<span class="ansi-green-intense-fg ansi-bold">   1453</span>             data after applying f
<span class="ansi-green-intense-fg ansi-bold">   1454</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">-&gt; 1455</span><span class="ansi-red-fg">         </span>values<span class="ansi-blue-fg">,</span> mutated <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>grouper<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>axis<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1456</span>
<span class="ansi-green-intense-fg ansi-bold">   1457</span>         <span class="ansi-green-fg">if</span> not_indexed_same <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/ops.py</span> in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">(self, f, data, axis)</span>
<span class="ansi-green-intense-fg ansi-bold">    774</span>             <span class="ansi-red-fg">#  so we will not have raised even if this is an invalid dtype.</span>
<span class="ansi-green-intense-fg ansi-bold">    775</span>             <span class="ansi-red-fg">#  So do one dummy call here to raise appropriate TypeError.</span>
<span class="ansi-green-fg">--&gt; 776</span><span class="ansi-red-fg">             </span>f<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>iloc<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    777</span>
<span class="ansi-green-intense-fg ansi-bold">    778</span>         <span class="ansi-green-fg">return</span> result_values<span class="ansi-blue-fg">,</span> mutated

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect_fn</span><span class="ansi-blue-fg">(self, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>
<span class="ansi-green-intense-fg ansi-bold">     69</span>     <span class="ansi-green-fg">def</span> _estimate_effect_fn<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 70</span><span class="ansi-red-fg">         </span>est <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_estimate_effect<span class="ansi-blue-fg">(</span>data_df<span class="ansi-blue-fg">,</span> need_conditional_estimates<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>         <span class="ansi-green-fg">return</span> est<span class="ansi-blue-fg">.</span>value
<span class="ansi-green-intense-fg ansi-bold">     72</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect</span><span class="ansi-blue-fg">(self, data_df, need_conditional_estimates)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>             self<span class="ansi-blue-fg">.</span>logger<span class="ansi-blue-fg">.</span>debug<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>summary<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span>         <span class="ansi-red-fg"># All treatments are set to the same constant value</span>
<span class="ansi-green-fg">---&gt; 53</span><span class="ansi-red-fg">         </span>effect_estimate <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_treatment_value<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_control_value<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         conditional_effect_estimates <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">if</span> need_conditional_estimates<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_do</span><span class="ansi-blue-fg">(self, treatment_val, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>         interventional_treatment_2d <span class="ansi-blue-fg">=</span> interventional_treatment_2d<span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>_treatment<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>
<span class="ansi-green-fg">--&gt; 131</span><span class="ansi-red-fg">         new_features = self._build_features(treatment_values=interventional_treatment_2d,
</span><span class="ansi-green-intense-fg ansi-bold">    132</span>                 data_df=data_df)
<span class="ansi-green-intense-fg ansi-bold">    133</span>         interventional_outcomes <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>predict_fn<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">,</span> new_features<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_build_features</span><span class="ansi-blue-fg">(self, treatment_values, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span>                 features <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>concatenate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>features<span class="ansi-blue-fg">,</span> new_features<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>         features <span class="ansi-blue-fg">=</span> features<span class="ansi-blue-fg">.</span>astype<span class="ansi-blue-fg">(</span>float<span class="ansi-blue-fg">,</span> copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># converting to float in case of binary treatment and no other variables</span>
<span class="ansi-green-fg">--&gt; 112</span><span class="ansi-red-fg">         </span>features <span class="ansi-blue-fg">=</span> sm<span class="ansi-blue-fg">.</span>add_constant<span class="ansi-blue-fg">(</span>features<span class="ansi-blue-fg">,</span> has_constant<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;add&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># to add an intercept term</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span>         <span class="ansi-green-fg">return</span> features
<span class="ansi-green-intense-fg ansi-bold">    114</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/statsmodels/tools/tools.py</span> in <span class="ansi-cyan-fg">add_constant</span><span class="ansi-blue-fg">(data, prepend, has_constant)</span>
<span class="ansi-green-intense-fg ansi-bold">    268</span>         <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Only implemented for 2-dimensional arrays&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>
<span class="ansi-green-fg">--&gt; 270</span><span class="ansi-red-fg">     </span>is_nonzero_const <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>ptp<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     is_nonzero_const <span class="ansi-blue-fg">&amp;=</span> np<span class="ansi-blue-fg">.</span>all<span class="ansi-blue-fg">(</span>x <span class="ansi-blue-fg">!=</span> <span class="ansi-cyan-fg">0.0</span><span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>     <span class="ansi-green-fg">if</span> is_nonzero_const<span class="ansi-blue-fg">.</span>any<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">&lt;__array_function__ internals&gt;</span> in <span class="ansi-cyan-fg">ptp</span><span class="ansi-blue-fg">(*args, **kwargs)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/numpy/core/fromnumeric.py</span> in <span class="ansi-cyan-fg">ptp</span><span class="ansi-blue-fg">(a, axis, out, keepdims)</span>
<span class="ansi-green-intense-fg ansi-bold">   2628</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2629</span>             <span class="ansi-green-fg">return</span> ptp<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span>axis<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2630</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> _methods<span class="ansi-blue-fg">.</span>_ptp<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span>axis<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2631</span>
<span class="ansi-green-intense-fg ansi-bold">   2632</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/numpy/core/_methods.py</span> in <span class="ansi-cyan-fg">_ptp</span><span class="ansi-blue-fg">(a, axis, out, keepdims)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> <span class="ansi-green-fg">def</span> _ptp<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    275</span>     return um.subtract(
<span class="ansi-green-fg">--&gt; 276</span><span class="ansi-red-fg">         </span>umr_maximum<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         umr_minimum<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    278</span>         out

<span class="ansi-red-fg">ValueError</span>: zero-size array to reduction operation maximum which has no identity
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#PLOT</span>
<span class="c1">#This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="c1">#the expected value for each estimator.</span>
<span class="n">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/4201346126.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-fg">#This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-red-fg">#the expected value for each estimator.</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>plot_MAEs<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;res&#39; is not defined
</pre></div></div>
</div>
<section id="Ranking-based-on-Original-Estimate">
<h2>Ranking based on Original Estimate<a class="headerlink" href="#Ranking-based-on-Original-Estimate" title="Permalink to this headline"></a></h2>
<p>The Original Estimate is calculated in the presence of the True Value (that is, the ground truth). However in many real life datasets, the ground truth may not be known. Hence, we want the ranking produced by our refutation tests to be in coherence with that obtained from the Original Estimates. According to the Original Estimate values, the ranking of the estimators should be as follows (the method with the least MAE should get the best rank): 1. DMLCateEstimator 2. LinearRegression 3.
LinearDRLearner 4. Propensity Score Matching</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backdoor.linear_regression&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.propensity_score_stratification&quot;,</span>
                  <span class="s2">&quot;backdoor.propensity_score_matching&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dml.DML&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dr.LinearDRLearner&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.TLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.XLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.LRSRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.XGBTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.MLPTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.BaseXRegressor&quot;</span>
                <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#This plot shows the deviation of the original estimate, the new effect and the estimated effect from the true value</span>
<span class="n">refuter</span> <span class="o">=</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span>
<span class="n">deviation_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimator_list</span><span class="p">:</span>
    <span class="n">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
    <span class="n">avg_deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
    <span class="n">deviation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/655886326.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> deviation_list <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-green-fg">for</span> estimator <span class="ansi-green-fg">in</span> estimator_list<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">     </span>plot_estimators_and_refuters<span class="ansi-blue-fg">(</span>refuter<span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     avg_deviation <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:NEW_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>sum<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     print<span class="ansi-blue-fg">(</span>avg_deviation<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/3026254069.py</span> in <span class="ansi-cyan-fg">plot_estimators_and_refuters</span><span class="ansi-blue-fg">(refuter, estimator)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> plot_estimators_and_refuters<span class="ansi-blue-fg">(</span>refuter<span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>x <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;EXPERIMENT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     y1 <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:ESTIMATED_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     y2 <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:NEW_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-red-fg">#print(res[&#39;TRUE_VALUE&#39;])</span>

<span class="ansi-red-fg">NameError</span>: name &#39;res&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deviation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/2845717398.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>plot_deviations<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     print<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#34;: &#34;</span><span class="ansi-blue-fg">+</span> str<span class="ansi-blue-fg">(</span>deviation_list<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/408894069.py</span> in <span class="ansi-cyan-fg">plot_deviations</span><span class="ansi-blue-fg">(estimator_list, deviation_list)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> plot_deviations<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     plt<span class="ansi-blue-fg">.</span>xticks<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> estimator_list<span class="ansi-blue-fg">,</span> rotation<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;vertical&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     plt<span class="ansi-blue-fg">.</span>show<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/pyplot.py</span> in <span class="ansi-cyan-fg">scatter</span><span class="ansi-blue-fg">(x, y, s, c, marker, cmap, norm, vmin, vmax, alpha, linewidths, edgecolors, plotnonfinite, data, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   3066</span>         vmin<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> linewidths<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   3067</span>         edgecolors=None, plotnonfinite=False, data=None, **kwargs):
<span class="ansi-green-fg">-&gt; 3068</span><span class="ansi-red-fg">     __ret = gca().scatter(
</span><span class="ansi-green-intense-fg ansi-bold">   3069</span>         x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">=</span>s<span class="ansi-blue-fg">,</span> c<span class="ansi-blue-fg">=</span>c<span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>marker<span class="ansi-blue-fg">,</span> cmap<span class="ansi-blue-fg">=</span>cmap<span class="ansi-blue-fg">,</span> norm<span class="ansi-blue-fg">=</span>norm<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   3070</span>         vmin<span class="ansi-blue-fg">=</span>vmin<span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span>vmax<span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span>alpha<span class="ansi-blue-fg">,</span> linewidths<span class="ansi-blue-fg">=</span>linewidths<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/__init__.py</span> in <span class="ansi-cyan-fg">inner</span><span class="ansi-blue-fg">(ax, data, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1359</span>     <span class="ansi-green-fg">def</span> inner<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1360</span>         <span class="ansi-green-fg">if</span> data <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1361</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>map<span class="ansi-blue-fg">(</span>sanitize_sequence<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1362</span>
<span class="ansi-green-intense-fg ansi-bold">   1363</span>         bound <span class="ansi-blue-fg">=</span> new_sig<span class="ansi-blue-fg">.</span>bind<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/axes/_axes.py</span> in <span class="ansi-cyan-fg">scatter</span><span class="ansi-blue-fg">(self, x, y, s, c, marker, cmap, norm, vmin, vmax, alpha, linewidths, edgecolors, plotnonfinite, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   4496</span>         y <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>ma<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span>y<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   4497</span>         <span class="ansi-green-fg">if</span> x<span class="ansi-blue-fg">.</span>size <span class="ansi-blue-fg">!=</span> y<span class="ansi-blue-fg">.</span>size<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 4498</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;x and y must be the same size&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   4499</span>
<span class="ansi-green-intense-fg ansi-bold">   4500</span>         <span class="ansi-green-fg">if</span> s <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">ValueError</span>: x and y must be the same size
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_17_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_17_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_png function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_rgba function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_mask function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The MathtextBackendBitmap class was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$\displaystyle \left\{ \right\}$</div></div>
</div>
</section>
<section id="Ranking-based-on-New-Effect-(Refutatation-results)">
<h2>Ranking based on New Effect (Refutatation results)<a class="headerlink" href="#Ranking-based-on-New-Effect-(Refutatation-results)" title="Permalink to this headline"></a></h2>
<p>The ranking based on absolute value of deviations is : 1. Propensity Score Matching 2. Linear DR Learner 3. DML CATE Estimator 4. Linear Regression</p>
<p>Clearly, the observed unmodelled confounding error is not able to match the ranking based on the Original Estimate. It is not even able to tell that the clear winner amongst the methods according to the true value is DML CATE Estimator</p>
</section>
</section>
<section id="Unobserved-confounding-error">
<h1>Unobserved confounding error<a class="headerlink" href="#Unobserved-confounding-error" title="Permalink to this headline"></a></h1>
<p>For each estimator, we now simulate unobserved confounders and check its effect using dummy outcome refuter to check the unobserved confounding error for each estimator. That is, we run the refutation test for each estimator not only on the observed confounder, but also on an unobserved confounder that we simulate using the AddUnobservedCommonCause class and analyse whether there is a strong confounder that is unobserved (missing) and needs to be accounted for.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unobserved_confounding_error</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
    <span class="n">num_experiments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># 10</span>
    <span class="n">sample_sizes</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
    <span class="n">dgps</span><span class="o">=</span><span class="n">dgp_list</span><span class="p">,</span>
    <span class="n">estimators</span><span class="o">=</span><span class="n">estimator_tuples</span><span class="p">,</span>
    <span class="n">refuters</span><span class="o">=</span><span class="n">refuter_tuples</span><span class="p">,</span>
    <span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">unobserved_confounding_error</span><span class="o">.</span><span class="n">experiment</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Running Experiment: Test_2


Running Experiment Number: 0


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[99.60589522],
       [-0.1599873 ],
       [-0.47125402],
       [ 1.07750586],
       [-0.20680104],
       [-0.94475535]]), &#39;confounder=&gt;outcome&#39;: array([[99.12876973],
       [ 0.12274805],
       [ 1.37571418],
       [-0.49352748],
       [-0.6239917 ],
       [ 0.87818925]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-1.22769743],
       [ 0.74293177]]), &#39;treatment=&gt;outcome&#39;: array([[0.26451385]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.11005176]), &#39;confounder=&gt;outcome&#39;: array([1.55641441])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.00856437]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w2,w3))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w2,w3,U) = P(y|t1,w2,w3)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
linear_regression
{&#39;control_value&#39;: 0, &#39;treatment_value&#39;: 1, &#39;test_significance&#39;: None, &#39;evaluate_effect_strength&#39;: False, &#39;confidence_intervals&#39;: False, &#39;target_units&#39;: &#39;ate&#39;, &#39;effect_modifiers&#39;: [&#39;x1&#39;, &#39;x2&#39;]}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/statsmodels/regression/linear_model.py:1918: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/855540001.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> <span class="ansi-red-fg"># Run the experiment</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg"> </span>res <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_csv<span class="ansi-blue-fg">(</span>unobserved_confounding_error<span class="ansi-blue-fg">.</span>experiment<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/3365708414.py</span> in <span class="ansi-cyan-fg">experiment</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>                         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;The current estimator:&#34;</span><span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;estimator.params&#34;</span><span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">.</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-fg">                         estimate = model.estimate_effect(
</span><span class="ansi-green-intense-fg ansi-bold">    118</span>                             identified_estimand<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>                             method_name <span class="ansi-blue-fg">=</span> estimator<span class="ansi-blue-fg">.</span>name<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_model.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self, identified_estimand, method_name, control_value, treatment_value, test_significance, evaluate_effect_strength, confidence_intervals, target_units, effect_modifiers, fit_estimator, method_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    314</span>                         target_units)
<span class="ansi-green-intense-fg ansi-bold">    315</span>
<span class="ansi-green-fg">--&gt; 316</span><span class="ansi-red-fg">             </span>estimate <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>causal_estimator<span class="ansi-blue-fg">.</span>estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    317</span>             <span class="ansi-red-fg"># Store parameters inside estimate object for refutation methods</span>
<span class="ansi-green-intense-fg ansi-bold">    318</span>             <span class="ansi-red-fg"># TODO: This add_params needs to move to the estimator class</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimator.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    189</span>         <span class="ansi-blue-fg">:</span>returns<span class="ansi-blue-fg">:</span> A CausalEstimate instance that contains point estimates of average <span class="ansi-green-fg">and</span> conditional effects<span class="ansi-blue-fg">.</span> Based on the parameters provided<span class="ansi-blue-fg">,</span> it optionally includes confidence intervals<span class="ansi-blue-fg">,</span> standard errors<span class="ansi-blue-fg">,</span>statistical significance <span class="ansi-green-fg">and</span> other statistical parameters<span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    190</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 191</span><span class="ansi-red-fg">         </span>est <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span>         est<span class="ansi-blue-fg">.</span>add_estimator<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    193</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect</span><span class="ansi-blue-fg">(self, data_df, need_conditional_estimates)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         conditional_effect_estimates <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">if</span> need_conditional_estimates<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 56</span><span class="ansi-red-fg">             conditional_effect_estimates = self._estimate_conditional_effects(
</span><span class="ansi-green-intense-fg ansi-bold">     57</span>                     self<span class="ansi-blue-fg">.</span>_estimate_effect_fn<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     58</span>                     effect_modifier_names=self._effect_modifier_names)

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_conditional_effects</span><span class="ansi-blue-fg">(self, estimate_effect_fn, effect_modifier_names, num_quantiles)</span>
<span class="ansi-green-intense-fg ansi-bold">    258</span>         by_effect_mods <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_data<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span>effect_modifier_names<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    259</span>         cond_est_fn <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">lambda</span> x<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_treatment_value<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_control_value<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 260</span><span class="ansi-red-fg">         </span>conditional_estimates <span class="ansi-blue-fg">=</span> by_effect_mods<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>estimate_effect_fn<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span>         <span class="ansi-red-fg"># Deleting the temporary categorical columns</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>         <span class="ansi-green-fg">for</span> em <span class="ansi-green-fg">in</span> effect_modifier_names<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">(self, func, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1412</span>         <span class="ansi-green-fg">with</span> option_context<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;mode.chained_assignment&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1413</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1414</span><span class="ansi-red-fg">                 </span>result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_python_apply_general<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_selected_obj<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1415</span>             <span class="ansi-green-fg">except</span> TypeError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1416</span>                 <span class="ansi-red-fg"># gh-20949</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ansi-cyan-fg">_python_apply_general</span><span class="ansi-blue-fg">(self, f, data, not_indexed_same)</span>
<span class="ansi-green-intense-fg ansi-bold">   1453</span>             data after applying f
<span class="ansi-green-intense-fg ansi-bold">   1454</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">-&gt; 1455</span><span class="ansi-red-fg">         </span>values<span class="ansi-blue-fg">,</span> mutated <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>grouper<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>axis<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1456</span>
<span class="ansi-green-intense-fg ansi-bold">   1457</span>         <span class="ansi-green-fg">if</span> not_indexed_same <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/pandas/core/groupby/ops.py</span> in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">(self, f, data, axis)</span>
<span class="ansi-green-intense-fg ansi-bold">    774</span>             <span class="ansi-red-fg">#  so we will not have raised even if this is an invalid dtype.</span>
<span class="ansi-green-intense-fg ansi-bold">    775</span>             <span class="ansi-red-fg">#  So do one dummy call here to raise appropriate TypeError.</span>
<span class="ansi-green-fg">--&gt; 776</span><span class="ansi-red-fg">             </span>f<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>iloc<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    777</span>
<span class="ansi-green-intense-fg ansi-bold">    778</span>         <span class="ansi-green-fg">return</span> result_values<span class="ansi-blue-fg">,</span> mutated

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect_fn</span><span class="ansi-blue-fg">(self, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>
<span class="ansi-green-intense-fg ansi-bold">     69</span>     <span class="ansi-green-fg">def</span> _estimate_effect_fn<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 70</span><span class="ansi-red-fg">         </span>est <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_estimate_effect<span class="ansi-blue-fg">(</span>data_df<span class="ansi-blue-fg">,</span> need_conditional_estimates<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>         <span class="ansi-green-fg">return</span> est<span class="ansi-blue-fg">.</span>value
<span class="ansi-green-intense-fg ansi-bold">     72</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect</span><span class="ansi-blue-fg">(self, data_df, need_conditional_estimates)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>             self<span class="ansi-blue-fg">.</span>logger<span class="ansi-blue-fg">.</span>debug<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>summary<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span>         <span class="ansi-red-fg"># All treatments are set to the same constant value</span>
<span class="ansi-green-fg">---&gt; 53</span><span class="ansi-red-fg">         </span>effect_estimate <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_treatment_value<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> self<span class="ansi-blue-fg">.</span>_do<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_control_value<span class="ansi-blue-fg">,</span> data_df<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         conditional_effect_estimates <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">if</span> need_conditional_estimates<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_do</span><span class="ansi-blue-fg">(self, treatment_val, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>         interventional_treatment_2d <span class="ansi-blue-fg">=</span> interventional_treatment_2d<span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>_treatment<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>
<span class="ansi-green-fg">--&gt; 131</span><span class="ansi-red-fg">         new_features = self._build_features(treatment_values=interventional_treatment_2d,
</span><span class="ansi-green-intense-fg ansi-bold">    132</span>                 data_df=data_df)
<span class="ansi-green-intense-fg ansi-bold">    133</span>         interventional_outcomes <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>predict_fn<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">,</span> new_features<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/regression_estimator.py</span> in <span class="ansi-cyan-fg">_build_features</span><span class="ansi-blue-fg">(self, treatment_values, data_df)</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span>                 features <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>concatenate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>features<span class="ansi-blue-fg">,</span> new_features<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>         features <span class="ansi-blue-fg">=</span> features<span class="ansi-blue-fg">.</span>astype<span class="ansi-blue-fg">(</span>float<span class="ansi-blue-fg">,</span> copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># converting to float in case of binary treatment and no other variables</span>
<span class="ansi-green-fg">--&gt; 112</span><span class="ansi-red-fg">         </span>features <span class="ansi-blue-fg">=</span> sm<span class="ansi-blue-fg">.</span>add_constant<span class="ansi-blue-fg">(</span>features<span class="ansi-blue-fg">,</span> has_constant<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;add&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># to add an intercept term</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span>         <span class="ansi-green-fg">return</span> features
<span class="ansi-green-intense-fg ansi-bold">    114</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/statsmodels/tools/tools.py</span> in <span class="ansi-cyan-fg">add_constant</span><span class="ansi-blue-fg">(data, prepend, has_constant)</span>
<span class="ansi-green-intense-fg ansi-bold">    268</span>         <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Only implemented for 2-dimensional arrays&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>
<span class="ansi-green-fg">--&gt; 270</span><span class="ansi-red-fg">     </span>is_nonzero_const <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>ptp<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     is_nonzero_const <span class="ansi-blue-fg">&amp;=</span> np<span class="ansi-blue-fg">.</span>all<span class="ansi-blue-fg">(</span>x <span class="ansi-blue-fg">!=</span> <span class="ansi-cyan-fg">0.0</span><span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>     <span class="ansi-green-fg">if</span> is_nonzero_const<span class="ansi-blue-fg">.</span>any<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">&lt;__array_function__ internals&gt;</span> in <span class="ansi-cyan-fg">ptp</span><span class="ansi-blue-fg">(*args, **kwargs)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/numpy/core/fromnumeric.py</span> in <span class="ansi-cyan-fg">ptp</span><span class="ansi-blue-fg">(a, axis, out, keepdims)</span>
<span class="ansi-green-intense-fg ansi-bold">   2628</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2629</span>             <span class="ansi-green-fg">return</span> ptp<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span>axis<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2630</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> _methods<span class="ansi-blue-fg">.</span>_ptp<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span>axis<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2631</span>
<span class="ansi-green-intense-fg ansi-bold">   2632</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/numpy/core/_methods.py</span> in <span class="ansi-cyan-fg">_ptp</span><span class="ansi-blue-fg">(a, axis, out, keepdims)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> <span class="ansi-green-fg">def</span> _ptp<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    275</span>     return um.subtract(
<span class="ansi-green-fg">--&gt; 276</span><span class="ansi-red-fg">         </span>umr_maximum<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         umr_minimum<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> keepdims<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    278</span>         out

<span class="ansi-red-fg">ValueError</span>: zero-size array to reduction operation maximum which has no identity
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="c1">#the expected value for each estimator.</span>
<span class="n">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/309141265.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg">##This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-fg">#the expected value for each estimator.</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>plot_MAEs<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;res&#39; is not defined
</pre></div></div>
</div>
<section id="id1">
<h2>Ranking based on Original Estimate<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<p>The Original Estimate is calculated in the presence of the True Value (that is, the ground truth). However in many real life datasets, the ground truth may not be known. Hence, we want the ranking produced by our refutation tests to be in coherence with that obtained from the Original Estimates. According to the Original Estimate values, the ranking of the estimators should be as follows (the method with the least MAE should get the best rank): 1. DMLCateEstimator 2. Propensity Score Matching 3.
LinearRegression 4. LinearDRLearner</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#This plot shows the deviation of the original estimate, the new effect and the estimated effect from the true value</span>
<span class="n">refuter</span> <span class="o">=</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span>
<span class="n">deviation_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimator_list</span><span class="p">:</span>
    <span class="n">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
    <span class="n">avg_deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
    <span class="n">deviation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/1776315406.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> deviation_list <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-green-fg">for</span> estimator <span class="ansi-green-fg">in</span> estimator_list<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">     </span>plot_estimators_and_refuters<span class="ansi-blue-fg">(</span>refuter<span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     avg_deviation <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:NEW_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>sum<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     print<span class="ansi-blue-fg">(</span>avg_deviation<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/3026254069.py</span> in <span class="ansi-cyan-fg">plot_estimators_and_refuters</span><span class="ansi-blue-fg">(refuter, estimator)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> plot_estimators_and_refuters<span class="ansi-blue-fg">(</span>refuter<span class="ansi-blue-fg">,</span> estimator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>x <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;EXPERIMENT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     y1 <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:ESTIMATED_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     y2 <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">[</span>refuter<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:&#39;</span><span class="ansi-blue-fg">+</span>estimator<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;:NEW_EFFECT&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-red-fg">#print(res[&#39;TRUE_VALUE&#39;])</span>

<span class="ansi-red-fg">NameError</span>: name &#39;res&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deviation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_12184/2845717398.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>plot_deviations<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     print<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#34;: &#34;</span><span class="ansi-blue-fg">+</span> str<span class="ansi-blue-fg">(</span>deviation_list<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_12184/408894069.py</span> in <span class="ansi-cyan-fg">plot_deviations</span><span class="ansi-blue-fg">(estimator_list, deviation_list)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> plot_deviations<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> deviation_list<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     plt<span class="ansi-blue-fg">.</span>xticks<span class="ansi-blue-fg">(</span>estimator_list<span class="ansi-blue-fg">,</span> estimator_list<span class="ansi-blue-fg">,</span> rotation<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;vertical&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     plt<span class="ansi-blue-fg">.</span>show<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/pyplot.py</span> in <span class="ansi-cyan-fg">scatter</span><span class="ansi-blue-fg">(x, y, s, c, marker, cmap, norm, vmin, vmax, alpha, linewidths, edgecolors, plotnonfinite, data, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   3066</span>         vmin<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> linewidths<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   3067</span>         edgecolors=None, plotnonfinite=False, data=None, **kwargs):
<span class="ansi-green-fg">-&gt; 3068</span><span class="ansi-red-fg">     __ret = gca().scatter(
</span><span class="ansi-green-intense-fg ansi-bold">   3069</span>         x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">=</span>s<span class="ansi-blue-fg">,</span> c<span class="ansi-blue-fg">=</span>c<span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>marker<span class="ansi-blue-fg">,</span> cmap<span class="ansi-blue-fg">=</span>cmap<span class="ansi-blue-fg">,</span> norm<span class="ansi-blue-fg">=</span>norm<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   3070</span>         vmin<span class="ansi-blue-fg">=</span>vmin<span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span>vmax<span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span>alpha<span class="ansi-blue-fg">,</span> linewidths<span class="ansi-blue-fg">=</span>linewidths<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/__init__.py</span> in <span class="ansi-cyan-fg">inner</span><span class="ansi-blue-fg">(ax, data, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1359</span>     <span class="ansi-green-fg">def</span> inner<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1360</span>         <span class="ansi-green-fg">if</span> data <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1361</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>map<span class="ansi-blue-fg">(</span>sanitize_sequence<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1362</span>
<span class="ansi-green-intense-fg ansi-bold">   1363</span>         bound <span class="ansi-blue-fg">=</span> new_sig<span class="ansi-blue-fg">.</span>bind<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy38/lib/python3.8/site-packages/matplotlib/axes/_axes.py</span> in <span class="ansi-cyan-fg">scatter</span><span class="ansi-blue-fg">(self, x, y, s, c, marker, cmap, norm, vmin, vmax, alpha, linewidths, edgecolors, plotnonfinite, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   4496</span>         y <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>ma<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span>y<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   4497</span>         <span class="ansi-green-fg">if</span> x<span class="ansi-blue-fg">.</span>size <span class="ansi-blue-fg">!=</span> y<span class="ansi-blue-fg">.</span>size<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 4498</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;x and y must be the same size&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   4499</span>
<span class="ansi-green-intense-fg ansi-bold">   4500</span>         <span class="ansi-green-fg">if</span> s <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">ValueError</span>: x and y must be the same size
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_29_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_29_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_png function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_rgba function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The to_mask function was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/IPython/lib/latextools.py:126: MatplotlibDeprecationWarning:
The MathtextBackendBitmap class was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use mathtext.math_to_image instead.
  mt.to_png(f, s, fontsize=12, dpi=dpi, color=color)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$\displaystyle \left\{ \right\}$</div></div>
</div>
</section>
<section id="id2">
<h2>Ranking based on New Effect (Refutatation results)<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p>The ranking based on absolute value of deviations is : 1. DML 2. Linear DR Learner 3. Propensity Score Matching 4. Linear Regression</p>
<section id="We-can-see-that-this-ranking-produces-the-same-top-ranked-estimator-as-the-one-based-on-Original-Estimate.-Thus-ranking-based-on-the-unobserved-confounding-error-solves-the-problem-and-gives-us-a-close-to-correct-ranking-amongst-methods.">
<h3>We can see that this ranking produces the same top-ranked estimator as the one based on Original Estimate. Thus ranking based on the unobserved confounding error solves the problem and gives us a close-to-correct ranking amongst methods.<a class="headerlink" href="#We-can-see-that-this-ranking-produces-the-same-top-ranked-estimator-as-the-one-based-on-Original-Estimate.-Thus-ranking-based-on-the-unobserved-confounding-error-solves-the-problem-and-gives-us-a-close-to-correct-ranking-amongst-methods." title="Permalink to this headline"></a></h3>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, PyWhy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>