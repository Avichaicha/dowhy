<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ranking of estimation methods for a given dataset &mdash; DoWhy | An end-to-end library for causal inference  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DoWhy | An end-to-end library for causal inference
          </a>
              <div class="version">
                0.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introducing DoWhy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">DoWhy | An end-to-end library for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#graphical-models-and-potential-outcomes-best-of-both-worlds">Graphical Models and Potential Outcomes: Best of both worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#four-steps-of-causal-inference">Four steps of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#citing-this-package">Citing this package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#roadmap">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#contributing">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick-Start Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial-causalinference-machinelearning-using-dowhy-econml.html">Tutorial on Causal Inference and its Connections to Machine Learning (Using DoWhy+EconML)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Starter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dowhy_simple_example.html">Getting started with DoWhy: A simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_confounder_example.html">Confounding Example: Finding causal effects from observed data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_estimation_methods.html">DoWhy: Different estimation methods for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy-simple-iv-example.html">Simple example on using Instrumental Variables method for estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_graph_example.html">Different ways to load an input graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_interpreter.html">DoWhy: Interpreters for Causal Estimators</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_api.html">Demo for the DoWhy causal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="do_sampler_demo.html">Do-sampler Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case Study Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">DoWhy-The Causal Story Behind Hotel Booking Cancellations</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_example_effect_of_memberrewards_program.html">Estimating the effect of a Member Rewards program</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_ihdp_data_example.html">DoWhy example on ihdp (Infant Health and Development Program) dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_twins_example.html">DoWhy example on Twins dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_lalonde_example.html">DoWhy example on the Lalonde dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_refutation_testing.html">Applying refutation tests to the Lalonde and IHDP datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="lalonde_pandas_api.html">Lalonde Pandas API Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dowhy-conditional-treatment-effects.html">Conditional Average Treatment Effects (CATE) with DoWhy and EconML</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_mediation_analysis.html">Mediation analysis with DoWhy: Direct and Indirect Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_demo_dummy_outcome_refuter.html">A Simple Example on Creating a Custom Refutation Using User-Defined Outcome Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_multiple_treatments.html">Estimating effect of multiple treatments</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_refuter_notebook.html">Iterating over multiple refutation tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html">Causal Discovery example</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Experiments-on-the-Auto-MPG-dataset">Experiments on the Auto-MPG dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Causal-Discovery-with-Causal-Discovery-Tool-(CDT)">Causal Discovery with Causal Discovery Tool (CDT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#Experiments-on-the-Sachs-dataset">Experiments on the Sachs dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dowhy_causal_discovery_example.html#id2">Causal Discovery with Causal Discovery Tool (CDT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="identifying_effects_using_id_algorithm.html">Identifying Effect using ID Algorithm</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy.html">dowhy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DoWhy | An end-to-end library for causal inference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Ranking of estimation methods for a given dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_notebooks/dowhy_ranking_methods.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Ranking-of-estimation-methods-for-a-given-dataset">
<h1>Ranking of estimation methods for a given dataset<a class="headerlink" href="#Ranking-of-estimation-methods-for-a-given-dataset" title="Permalink to this headline"></a></h1>
<p>We illustrate the comparison of various estimation methods for a given datasets by ranking them according to their performance against refutation tests accounting for both the observed unmodelled confounding error and unobserved confounding error.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing all the required libraries</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">xgboost</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegressionCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="kn">import</span> <span class="nn">dowhy</span>
<span class="kn">from</span> <span class="nn">dowhy.utils</span> <span class="kn">import</span> <span class="n">dgp</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.dgps.linear_dgp</span> <span class="kn">import</span> <span class="n">LinearDataGeneratingProcess</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_refuters.add_unobserved_common_cause</span> <span class="kn">import</span> <span class="n">AddUnobservedCommonCause</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">mtransforms</span>

<span class="c1"># Config dict to set the logging level</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
<span class="n">DEFAULT_LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;WARN&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">DEFAULT_LOGGING</span><span class="p">)</span>
<span class="c1"># Disabling warnings output</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">DataConversionWarning</span><span class="p">,</span> <span class="n">ConvergenceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">DataConversionWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_singleton_to_float</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Helper function.&#39;&#39;&#39;</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This script only accepts one value for the refute&quot;</span><span class="p">)</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">array</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ensure_dir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<span class="n">RESULTSFOLDER</span> <span class="o">=</span> <span class="s2">&quot;results/&quot;</span>
<span class="n">ensure_dir</span><span class="p">(</span><span class="n">RESULTSFOLDER</span><span class="p">)</span>
<span class="c1"># Create the estimator named tuple to wrap the name and properties</span>
<span class="n">Estimator</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Estimator&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>
<span class="n">Refuter</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Refuter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">Experiment</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to define the experiment setup to compare a list of estimators across a list of refuters for the given dataset.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;experiment_name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_experiments</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;num_experiments&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sample_sizes&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dgps&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;estimators&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;refuters&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;simulate_unobserved_confounding&quot;</span><span class="p">]</span>

        <span class="c1"># Handle input errors in sample_sizes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;sample_sizes&quot; should be an int or a list&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">]</span>

        <span class="c1"># Handle input errors in DGPs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">,</span> <span class="n">DataGeneratingProcess</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;dgps&quot; should be a list or a subclass of &quot;DataGeneratingProcess&quot;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">]</span>

        <span class="c1"># Handle inputs errors in estimators</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">,</span> <span class="n">Estimator</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;estimators&quot; should be a list or an Estimator namedtuple&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">]</span>

        <span class="c1"># Handle input errors in refuters</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">,</span> <span class="n">Refuter</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The input to &quot;refuters&quot; should be a list of a Refuter namedtuple&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running Experiment:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_experiments</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running Experiment Number:&quot;</span><span class="p">,</span><span class="n">exp</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">sample_size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_sizes</span><span class="p">:</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Current Sample Size:&quot;</span><span class="p">,</span><span class="n">sample_size</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">dgp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgps</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">The current DGP:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">dgp</span><span class="p">)</span>
                    <span class="n">estimates</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">estimate_values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">estimated_effect</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">new_effect</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">p_value</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">generate_data</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing data shape&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">dgp</span><span class="o">.</span><span class="n">true_value</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dgp</span><span class="o">.</span><span class="n">treatment_is_binary</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
                    <span class="c1">#k = len(dgp.confounder)-4</span>
                    <span class="c1">#confounder_list = random.sample(dgp.confounder, k)</span>
                    <span class="n">confounder_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w2&#39;</span><span class="p">,</span><span class="s1">&#39;w3&#39;</span><span class="p">]</span>


                    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">confounder_list</span><span class="p">)</span>
                    <span class="n">unobserved_confounders</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dgp</span><span class="o">.</span><span class="n">confounder</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
                    <span class="n">df_unobserved_confounders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unobserved_confounders</span><span class="p">]])</span>

                    <span class="n">df_unobserved_confounders</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;results/unobserved_confounders.csv&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing length of confounder list:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">confounder_list</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing confounder list:&quot;</span><span class="p">,</span> <span class="n">confounder_list</span><span class="p">)</span>



                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data columns&quot;</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data columns&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                        <span class="n">treatment</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
                        <span class="n">outcome</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                        <span class="n">common_causes</span> <span class="o">=</span> <span class="n">confounder_list</span><span class="p">,</span>
                        <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="n">dgp</span><span class="o">.</span><span class="n">effect_modifier</span>
                    <span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">view_model</span><span class="p">()</span>
                    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;causal_model.png&quot;</span><span class="p">))</span>

                    <span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">(</span><span class="n">proceed_when_unidentifiable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;identified_estimand:&quot;</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">)</span>
                    <span class="c1">#print(&quot;identified_estimand:&quot;, identified_estimand)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running the estimators:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The current estimator:&quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimator.params&quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                        <span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
                            <span class="n">identified_estimand</span><span class="p">,</span>
                            <span class="n">method_name</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">method_params</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">params</span>
                        <span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing estimate&#39;s type&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">estimate</span><span class="p">))</span>
                        <span class="n">estimates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span>
                        <span class="n">estimate_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">estimate_values</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">estimate_values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimate_values&quot;</span><span class="p">,</span> <span class="n">estimate_values</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Running the refuters:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">refuter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The current refuter:&quot;</span><span class="p">,</span> <span class="n">refuter</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">estimate</span> <span class="ow">in</span> <span class="n">estimates</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_unobserved_confounding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;********</span><span class="si">%%%%%%%%</span><span class="s2">%$$$$$&amp;&amp;^**^^^^*^*^*&quot;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">:</span>
                                    <span class="n">add_unobserved_confounder</span> <span class="o">=</span> <span class="n">AddUnobservedCommonCause</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;add_unobserved_confounder&quot;</span><span class="p">,</span> <span class="n">add_unobserved_confounder</span><span class="p">)</span>
                                    <span class="n">unobserved_confounder_values</span> <span class="o">=</span> <span class="n">add_unobserved_confounder</span><span class="o">.</span><span class="n">include_simulated_confounder</span><span class="p">(</span><span class="n">convergence_threshold</span> <span class="o">=</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">c_star_max</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">)</span>
                                    <span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;unobserved_confounder_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unobserved_confounder_values</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refuter.params&#39;</span><span class="p">,</span> <span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                            <span class="n">refute</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span>
                                <span class="n">identified_estimand</span><span class="p">,</span>
                                <span class="n">estimate</span><span class="p">,</span>
                                <span class="n">method_name</span> <span class="o">=</span> <span class="n">refuter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">refuter</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>



                            <span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;printing refute&#39;s type&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">refute</span><span class="p">))</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">):</span>
                                <span class="n">refute</span> <span class="o">=</span> <span class="n">refute</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">refute</span><span class="o">.</span><span class="n">refutation_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">p_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">refutation_result</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">p_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                            <span class="n">estimated_effect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">estimated_effect</span><span class="p">)</span>
                            <span class="c1">#print(&quot;refute.estimate_effect()&quot;, refute.estimate_effect())</span>
                            <span class="n">new_effect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span><span class="p">)</span>

                    <span class="n">estimated_effect</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">estimated_effect</span><span class="p">)</span>
                    <span class="n">new_effect</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">new_effect</span><span class="p">)</span>
                    <span class="n">p_value</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>
                    <span class="n">true_value</span> <span class="o">=</span> <span class="n">convert_singleton_to_float</span><span class="p">(</span><span class="n">dgp</span><span class="o">.</span><span class="n">true_value</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimated effect&quot;</span><span class="p">,</span> <span class="n">estimated_effect</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new_effect&quot;</span><span class="p">,</span> <span class="n">new_effect</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p_value&quot;</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true value&quot;</span><span class="p">,</span> <span class="n">true_value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">dgp</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="o">*</span><span class="n">estimate_values</span><span class="p">,</span> <span class="o">*</span><span class="n">estimated_effect</span><span class="p">,</span> <span class="o">*</span><span class="n">new_effect</span><span class="p">,</span> <span class="o">*</span><span class="n">p_value</span><span class="p">,</span> <span class="n">true_value</span><span class="p">])</span>


        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Completed all experiments. Saving the data...&quot;</span><span class="p">)</span>

        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EXPERIMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_SIZE&#39;</span><span class="p">,</span> <span class="s1">&#39;DGP&#39;</span><span class="p">]</span>
        <span class="n">RESULT_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ESTIMATED_EFFECT&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW_EFFECT&#39;</span><span class="p">,</span> <span class="s1">&#39;P_VALUE&#39;</span><span class="p">]</span>
        <span class="n">estimator_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimator</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">]</span>
        <span class="n">refuter_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">refuter</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">refuter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refuters</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">estimator_name</span> <span class="ow">in</span> <span class="n">estimator_names</span><span class="p">:</span>
            <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;ORIGINAL_ESTIMATE&#39;</span><span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">estimator_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">result_category</span> <span class="ow">in</span> <span class="n">RESULT_CATEGORIES</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">refuter_name</span> <span class="ow">in</span> <span class="n">refuter_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">estimator_name</span> <span class="ow">in</span> <span class="n">estimator_names</span><span class="p">:</span>
                    <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">refuter_name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">estimator_name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">result_category</span><span class="p">]</span>

        <span class="n">COLUMNS</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;TRUE_VALUE&#39;</span><span class="p">]</span>

        <span class="n">csv_file</span> <span class="o">=</span> <span class="n">RESULTSFOLDER</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;_data.csv&#39;</span>
        <span class="n">onlyres_csv_file</span> <span class="o">=</span> <span class="n">RESULTSFOLDER</span> <span class="o">+</span> <span class="s2">&quot;onlyres_&quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;_data.csv&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data has been saved in &quot;</span><span class="p">,</span><span class="n">csv_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">csv_file</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Defining the Data Generating Process</span>
<span class="n">ldgp</span> <span class="o">=</span> <span class="n">LinearDataGeneratingProcess</span><span class="p">(</span><span class="n">treatment</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">confounder</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;w1&#39;</span><span class="p">,</span><span class="s1">&#39;w2&#39;</span><span class="p">,</span> <span class="s1">&#39;w3&#39;</span><span class="p">,</span><span class="s1">&#39;w4&#39;</span><span class="p">,</span><span class="s1">&#39;w5&#39;</span><span class="p">,</span><span class="s1">&#39;w6&#39;</span><span class="p">],</span> <span class="n">effect_modifier</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Defining the sample size</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">dgp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ldgp&#39;</span><span class="p">:</span><span class="n">ldgp</span><span class="p">}</span>
<span class="n">dgp_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dgp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dgp_dict</span><span class="p">[</span><span class="s1">&#39;ldgp&#39;</span><span class="p">]</span> <span class="p">)</span>


<span class="c1"># Create a namedtuple to store the name of the estimator and the parameters passed</span>
<span class="n">estimator_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backdoor.linear_regression&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.propensity_score_stratification&quot;,</span>
                  <span class="s2">&quot;backdoor.propensity_score_matching&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.propensity_score_weighting&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dml.DML&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dr.LinearDRLearner&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.TLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.XLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.LRSRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.XGBTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.MLPTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.BaseXRegressor&quot;</span>
                <span class="p">]</span>
<span class="n">method_params</span><span class="o">=</span> <span class="p">[</span>    <span class="kc">None</span><span class="p">,</span>
                    <span class="c1">#None,</span>
                    <span class="p">{</span> <span class="s2">&quot;init_params&quot;</span><span class="p">:{}</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&quot;init_params&quot;</span><span class="p">:{}</span> <span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                    <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                    <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                                    <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                     <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}},</span>
                    <span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span> <span class="s1">&#39;model_propensity&#39;</span><span class="p">:</span> <span class="n">LogisticRegressionCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}</span>
                    <span class="p">},</span>
                    <span class="sd">&#39;&#39;&#39;{&quot;init_params&quot;: {&#39;models&#39;: GradientBoostingRegressor(n_estimators=100, max_depth=6, min_samples_leaf=int(sample_size/100))</span>
<span class="sd">                                    },</span>
<span class="sd">                    &quot;fit_params&quot;:{}</span>
<span class="sd">                    },</span>
<span class="sd">                    {&quot;init_params&quot;:{&#39;models&#39;: GradientBoostingRegressor(n_estimators=100, max_depth=6, min_samples_leaf=int(sample_size/100)),</span>
<span class="sd">                        &#39;propensity_model&#39;: RandomForestClassifier(n_estimators=100, max_depth=6,</span>
<span class="sd">                                                                              min_samples_leaf=int(sample_size/100))</span>
<span class="sd">                        },</span>
<span class="sd">                     &quot;fit_params&quot;:{}</span>
<span class="sd">                    },</span>
<span class="sd">                    {&quot;init_params&quot;:{},},</span>
<span class="sd">                    {&quot;init_params&quot;:{</span>
<span class="sd">                        &#39;learner&#39;:XGBRegressor()</span>
<span class="sd">                        }</span>
<span class="sd">                    }&#39;&#39;&#39;</span>
                <span class="p">]</span>
<span class="n">estimator_tuples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">refuter_tuples</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">refuter_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dummy_outcome_refuter&#39;</span><span class="p">]</span>
<span class="n">refuter_params</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;num_simulations&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;transformation_list&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;random_forest&#39;</span><span class="p">,{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">})],</span> <span class="s1">&#39;true_causal_effect&#39;</span><span class="p">:(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mf">0.5</span><span class="p">)}]</span>


<span class="c1"># Iterate through the names and parameters to create a list of namedtuples</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span><span class="n">method_params</span><span class="p">):</span>
    <span class="n">estimator_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Estimator</span><span class="o">.</span><span class="n">_make</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">refuter_list</span><span class="p">,</span> <span class="n">refuter_params</span><span class="p">):</span>
    <span class="n">refuter_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Refuter</span><span class="o">.</span><span class="n">_make</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">]))</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="n">true_value_column</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">estimate_columns</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#print(estimate_columns)</span>
    <span class="c1">#print(type(estimate_columns))</span>
    <span class="n">estimate_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">]))</span>
    <span class="c1">#print(estimate_columns)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">MAE</span> <span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">estimate_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ORIGINAL_ESTIMATE:backdoor.propensity_score_weighting&#39;</span><span class="p">,):</span>
                           <span class="c1">#&#39;ORIGINAL_ESTIMATE:backdoor.econml.metalearners.TLearner&#39;):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">colname</span><span class="p">)</span>
            <span class="s2">&quot;Mean Absolute Error (MAE): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">]))</span>
            <span class="n">MAE</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;TRUE_VALUE&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Calibration plot showing the accuracy of different causal estimators [P(T=1)=0.9]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Estimated effect&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True causal effect&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.20</span><span class="p">),</span>
              <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing MAE of various estimates: &quot;</span><span class="p">)</span>
    <span class="n">MAE_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">MAE</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">MAE_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;EXPERIMENT&#39;</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:ESTIMATED_EFFECT&#39;</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span>
    <span class="c1">#print(res[&#39;TRUE_VALUE&#39;])</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;TRUE_VALUE&#39;</span><span class="p">])</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:P_VALUE&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Estimated Effect&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;New Effect&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;True Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;P Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;EXPERIMENT&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;EFFECT&quot;</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">estimator_list</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Observed-unmodelled-confounding-error">
<h1>Observed unmodelled confounding error<a class="headerlink" href="#Observed-unmodelled-confounding-error" title="Permalink to this headline"></a></h1>
<p>For each estimator, we use dummy outcome refuter to check the observed unmodelled confounding error for each estimator. That is, we run the refutation test for each estimator only on the observed confounders and analyse what amount of confounding error is present unmodelled amongst the observed variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the properties of the experiment</span>
<span class="c1"># The name of the experiment</span>
<span class="c1"># The experiment ID</span>
<span class="c1"># The number of experiments to be run with the SAME parameters</span>
<span class="c1"># The size of the samples to be run</span>
<span class="c1"># The list of DGPs to be run</span>
<span class="c1"># The list of estimators</span>
<span class="n">observed_confounding_error</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="n">num_experiments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># 10</span>
    <span class="n">sample_sizes</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
    <span class="n">dgps</span><span class="o">=</span><span class="n">dgp_list</span><span class="p">,</span>
    <span class="n">estimators</span><span class="o">=</span><span class="n">estimator_tuples</span><span class="p">,</span>
    <span class="n">refuters</span><span class="o">=</span><span class="n">refuter_tuples</span><span class="p">,</span>
    <span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">observed_confounding_error</span><span class="o">.</span><span class="n">experiment</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Running Experiment: Test_1


Running Experiment Number: 0


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {}
        bias: {}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.14660725]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/amshar/python-environments/vpy38/lib/python3.8/site-packages/statsmodels/regression/linear_model.py:1860: RuntimeWarning: divide by zero encountered in double_scalars
  return np.sqrt(eigvals[0]/eigvals[-1])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-03-02 10:15:47.235896: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2022-03-02 10:15:47.236109: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [72.97951414763648, 73.24755545252248, 71.23537924080709, 73.72293530933325, 72.88712609901053]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [-2.3540649681025876, -0.2640889121386259, -0.9572671543194481, -1.7952751298623002, -4.96775144840632]
p_value [0.11480076735957256, 0.35553975061406085, 0.3373647133673001, 0.03753928928753436, 0.019812390029227966]
true value -0.14660725043225453


Running Experiment Number: 1


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[102.54692894],
       [  1.42975104],
       [  1.6466068 ],
       [ -1.12283709],
       [  0.58743008],
       [  0.30323189]]), &#39;confounder=&gt;outcome&#39;: array([[ 1.00104345e+02],
       [-1.27776060e-01],
       [ 2.77129966e-01],
       [-8.38138093e-02],
       [ 1.25350276e-01],
       [-9.27600214e-01]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.30831795],
       [-0.27478035]]), &#39;treatment=&gt;outcome&#39;: array([[-0.14660725]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.86423093]), &#39;confounder=&gt;outcome&#39;: array([-0.2834461])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.52469497]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_14.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [66.1674915230785, 66.85538646440206, 64.75464528659258, 65.34297484578234, 66.52606584393132]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [1.4563759201422706, 0.7733703219050371, -0.2564628599636379, -0.646212685642558, 2.754271255580786]
p_value [0.31427745654073125, 0.46722864927481406, 0.39007704210944283, 0.16180057071674703, 0.17764835165323134]
true value 0.5246949704727033


Running Experiment Number: 2


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.33845439],
       [  2.5303343 ],
       [  0.14516038],
       [ -0.37452961],
       [  1.85644198],
       [ -1.29886708]]), &#39;confounder=&gt;outcome&#39;: array([[99.90278553],
       [ 1.68481513],
       [-0.75801886],
       [-0.26907698],
       [-0.22288387],
       [-1.93897461]]), &#39;effect_modifier=&gt;outcome&#39;: array([[ 1.44837613],
       [-1.75825401]]), &#39;treatment=&gt;outcome&#39;: array([[0.52469497]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.71160044]), &#39;confounder=&gt;outcome&#39;: array([1.34325147])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.61946527]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_23.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_23.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [65.6899455073204, 66.99923754322302, 64.73571648586883, 63.72434680086488, 65.75144775072535]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [3.61063248703624, -0.08713743781362841, 3.5363282101401046, 5.008768513489399e-16, 1.6387895837922593]
p_value [0.247283832899983, 0.4269643674908109, 0.2110131305561465, 0.0, 0.2793265956751411]
true value 0.6194652694024999


Running Experiment Number: 3


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.10480343],
       [ -1.38621743],
       [ -0.39974671],
       [  0.5638876 ],
       [ -1.42539861],
       [  1.11875685]]), &#39;confounder=&gt;outcome&#39;: array([[99.79685983],
       [-0.2306537 ],
       [-0.69585228],
       [-0.2580751 ],
       [ 0.9274527 ],
       [-1.20323366]]), &#39;effect_modifier=&gt;outcome&#39;: array([[1.07682358],
       [0.14527597]]), &#39;treatment=&gt;outcome&#39;: array([[0.61946527]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.63512322]), &#39;confounder=&gt;outcome&#39;: array([1.49772427])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.30638888]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_30.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_30.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [73.07669356260507, 73.9353302150129, 71.80412660266543, 62.02612424583945, 73.384937851967]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [1.2205136125107396, -1.3516282303140792, 1.5208755550816053, -0.31530968614046817, -0.5706436231715044]
p_value [0.36327890950249997, 0.11842462378449836, 0.38150951877407957, 0.1903369241267585, 0.2631925300872199]
true value -0.3063888791724129


Running Experiment Number: 4


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[99.94656757],
       [ 1.40073576],
       [-0.7662486 ],
       [ 0.1357568 ],
       [ 0.52720053],
       [ 1.74656011]]), &#39;confounder=&gt;outcome&#39;: array([[ 9.85770882e+01],
       [ 1.06964355e+00],
       [ 1.29523793e+00],
       [ 6.82388601e-01],
       [-1.32161869e+00],
       [ 9.55608311e-02]]), &#39;effect_modifier=&gt;outcome&#39;: array([[ 1.24401639],
       [-0.4431828 ]]), &#39;treatment=&gt;outcome&#39;: array([[-0.30638888]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.85430203]), &#39;confounder=&gt;outcome&#39;: array([1.38261815])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.1166164]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_39.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_39.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [72.48488528554806, 69.02286589052952, 72.12862145148357, 59.638442766059484, 72.53153660366527]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [-1.6301225395134662, 2.0942908665698297, 1.3434147750484915, 0.7478646569957538, -0.8865332755117097]
p_value [0.2541657812059216, 0.3539454880131399, 0.3837855479540747, 0.4130918509815611, 0.27698991469461975]
true value 0.11661639569789224


Running Experiment Number: 5


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[ 1.01144627e+02],
       [ 7.89099802e-02],
       [-1.56628756e-01],
       [-1.43590205e+00],
       [-1.76745751e-01],
       [ 4.05422760e-03]]), &#39;confounder=&gt;outcome&#39;: array([[ 1.00690713e+02],
       [ 1.02635743e+00],
       [ 1.15553495e+00],
       [-1.02920228e-02],
       [ 1.00844460e+00],
       [ 1.14069299e+00]]), &#39;effect_modifier=&gt;outcome&#39;: array([[1.16967011],
       [1.09644745]]), &#39;treatment=&gt;outcome&#39;: array([[0.1166164]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.41387697]), &#39;confounder=&gt;outcome&#39;: array([1.53308605])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-1.07488306]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_47.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_47.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [66.76533547523641, 70.24151515105433, 67.10397300410094, 61.418882726917246, 66.65639681267625]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [5.435540436287232, 4.822802270754273, 3.383302204250856, 1.417629878033198, 1.7518764814292944]
p_value [0.027397544511666407, 0.06047461939966106, 0.0645542094079918, 0.3043959950631514, 0.3117599672694688]
true value -1.074883063474456


Running Experiment Number: 6


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[98.89494516],
       [-0.95027152],
       [ 1.29461536],
       [-1.60138242],
       [-1.60849118],
       [ 0.25109645]]), &#39;confounder=&gt;outcome&#39;: array([[100.3133786 ],
       [ -0.34979481],
       [ -2.3592227 ],
       [  0.98594095],
       [ -3.10987867],
       [ -1.28177694]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-1.61613924],
       [ 0.12022274]]), &#39;treatment=&gt;outcome&#39;: array([[-1.07488306]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([1.11242198]), &#39;confounder=&gt;outcome&#39;: array([-0.8504839])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.58876591]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_54.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_54.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [64.56875963032962, 66.5278665000672, 64.37140799810632, 57.386949904344846, 64.50821629601776]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [2.6693993682359247, 2.460533587768463, 1.5441002763899798, -0.18008118877454748, 1.2138447068566374]
p_value [0.13612046552960544, 0.3105324427667033, 0.4081297302088512, 0.3261337597343954, 0.35904851061581267]
true value -0.5887659083644596


Running Experiment Number: 7


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[ 9.92202359e+01],
       [ 2.42122944e-01],
       [ 1.40043766e-01],
       [-2.54636610e-06],
       [ 9.08538652e-01],
       [-6.95985673e-01]]), &#39;confounder=&gt;outcome&#39;: array([[ 1.01095979e+02],
       [-2.15715180e+00],
       [ 1.03340784e-02],
       [ 3.21735573e-01],
       [ 1.68376435e-01],
       [-1.25258913e+00]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.27008013],
       [ 1.10384289]]), &#39;treatment=&gt;outcome&#39;: array([[-0.58876591]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.44013712]), &#39;confounder=&gt;outcome&#39;: array([-0.53511429])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.33133225]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_63.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_63.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [68.82448105050081, 85.55285275450014, 70.17004078546032, 61.55548428472502, 69.96962959729214]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [-0.5756016515349778, -0.3138209399144786, 0.9975128006994695, 0.14901089466494, 0.2805912886502318]
p_value [0.39709209742488927, 0.4224864349212889, 0.43618032569238696, 0.3892640427740869, 0.46600162394711764]
true value -0.33133224530772326


Running Experiment Number: 8


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.73715178],
       [  1.62023161],
       [  2.40940167],
       [ -0.5022416 ],
       [ -1.15602081],
       [ -0.53719231]]), &#39;confounder=&gt;outcome&#39;: array([[ 9.93065142e+01],
       [ 2.05531102e+00],
       [ 1.24248535e+00],
       [-6.11784588e-01],
       [-6.96124216e-02],
       [-1.01262238e-01]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.01280008],
       [-1.24460161]]), &#39;treatment=&gt;outcome&#39;: array([[-0.33133225]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.65066437]), &#39;confounder=&gt;outcome&#39;: array([0.96853141])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.41693834]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_71.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_71.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [50.62394343789601, 55.76126356484053, 51.99780225335623, 50.80518540989741, 50.830424752204536]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [-0.22117568903051463, 0.8968465695485228, 1.6347652953559844, 0.6501756969312676, -0.26392986275909813]
p_value [0.40607477657298374, 0.41915404045352356, 0.39073096149981357, 0.45402894777489233, 0.2727206183910511]
true value 0.41693833747549086


Running Experiment Number: 9


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[ 1.01171296e+02],
       [-6.68824125e-01],
       [ 7.25283165e-02],
       [ 1.45203583e+00],
       [ 2.80535318e-01],
       [-2.27790996e-01]]), &#39;confounder=&gt;outcome&#39;: array([[99.00321216],
       [-0.78607197],
       [ 0.44402023],
       [ 0.13153755],
       [-1.31926912],
       [ 0.33705476]]), &#39;effect_modifier=&gt;outcome&#39;: array([[0.77590702],
       [0.2624513 ]]), &#39;treatment=&gt;outcome&#39;: array([[0.41693834]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.37438717]), &#39;confounder=&gt;outcome&#39;: array([-0.09456353])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-1.06632221]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_11_79.png" src="../_images/example_notebooks_dowhy_ranking_methods_11_79.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [57.13248694540903, 53.45314139527743, 56.952035388371876, 48.77833614907823, 57.31132788602164]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [-1.186665736268264, -2.8398237014112424, -1.2568692009713622, 0.3180042890969842, 0.9812533231418064]
p_value [0.32037571625435834, 0.07600058362237883, 0.26771864101367415, 0.24766695664092775, 0.4395782038468923]
true value -1.0663222094900675


Completed all experiments. Saving the data...
Data has been saved in  results/Test_1_2022-03-02_data.csv
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#PLOT</span>
<span class="c1">#This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="c1">#the expected value for each estimator.</span>
<span class="n">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_12_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_12_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Printing MAE of various estimates:
ORIGINAL_ESTIMATE:backdoor.propensity_score_matching 68.34335995146225
ORIGINAL_ESTIMATE:backdoor.econml.dr.LinearDRLearner 66.21936940767047
ORIGINAL_ESTIMATE:backdoor.linear_regression 66.0150121148753
ORIGINAL_ESTIMATE:backdoor.econml.dml.DML 60.62362470260349
dummy_outcome_refuter:backdoor.linear_regression:NEW_EFFECT 2.017526304774168
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:NEW_EFFECT 1.7307186639629866
dummy_outcome_refuter:backdoor.propensity_score_weighting:NEW_EFFECT 1.689101393651449
dummy_outcome_refuter:backdoor.propensity_score_matching:NEW_EFFECT 1.531357940211754
dummy_outcome_refuter:backdoor.econml.dml.DML:NEW_EFFECT 0.9078314532326781
dummy_outcome_refuter:backdoor.linear_regression:ESTIMATED_EFFECT 0.7124905062943194
dummy_outcome_refuter:backdoor.propensity_score_matching:ESTIMATED_EFFECT 0.7124905062943194
dummy_outcome_refuter:backdoor.propensity_score_weighting:ESTIMATED_EFFECT 0.7124905062943194
dummy_outcome_refuter:backdoor.econml.dml.DML:ESTIMATED_EFFECT 0.7124905062943194
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:ESTIMATED_EFFECT 0.7124905062943194
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:P_VALUE 0.6365469312665111
dummy_outcome_refuter:backdoor.econml.dml.DML:P_VALUE 0.6325562258609755
dummy_outcome_refuter:backdoor.propensity_score_weighting:P_VALUE 0.6246203290147131
dummy_outcome_refuter:backdoor.linear_regression:P_VALUE 0.5604376953668991
dummy_outcome_refuter:backdoor.propensity_score_matching:P_VALUE 0.5347270029752823
</pre></div></div>
</div>
<section id="Ranking-based-on-Original-Estimate">
<h2>Ranking based on Original Estimate<a class="headerlink" href="#Ranking-based-on-Original-Estimate" title="Permalink to this headline"></a></h2>
<p>The Original Estimate is calculated in the presence of the True Value (that is, the ground truth). However in many real life datasets, the ground truth may not be known. Hence, we want the ranking produced by our refutation tests to be in coherence with that obtained from the Original Estimates. According to the Original Estimate values, the ranking of the estimators should be as follows (the method with the least MAE should get the best rank): 1. DMLCateEstimator 2. LinearRegression 3.
LinearDRLearner 4. Propensity Score Matching</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backdoor.linear_regression&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.propensity_score_stratification&quot;,</span>
                  <span class="s2">&quot;backdoor.propensity_score_matching&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dml.DML&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;backdoor.econml.dr.LinearDRLearner&quot;</span><span class="p">,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.TLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.econml.metalearners.XLearner&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.LRSRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.XGBTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.MLPTRegressor&quot;,</span>
                  <span class="c1">#&quot;backdoor.causalml.inference.meta.BaseXRegressor&quot;</span>
                <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#This plot shows the deviation of the original estimate, the new effect and the estimated effect from the true value</span>
<span class="n">refuter</span> <span class="o">=</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span>
<span class="n">deviation_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimator_list</span><span class="p">:</span>
    <span class="n">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
    <span class="n">avg_deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
    <span class="n">deviation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_16_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_16_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8.424831239762597
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_16_2.png" src="../_images/example_notebooks_dowhy_ranking_methods_16_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6.1913443949540685
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_16_4.png" src="../_images/example_notebooks_dowhy_ranking_methods_16_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.3458067253022701
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_16_6.png" src="../_images/example_notebooks_dowhy_ranking_methods_16_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.931768429602383
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deviation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_17_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
backdoor.linear_regression: 8.424831239762597
backdoor.propensity_score_matching: 6.1913443949540685
backdoor.econml.dml.DML: 0.3458067253022701
backdoor.econml.dr.LinearDRLearner: 1.931768429602383
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;backdoor.linear_regression&#39;: 8.424831239762597,
 &#39;backdoor.propensity_score_matching&#39;: 6.1913443949540685,
 &#39;backdoor.econml.dr.LinearDRLearner&#39;: 1.931768429602383,
 &#39;backdoor.econml.dml.DML&#39;: 0.3458067253022701}
</pre></div></div>
</div>
</section>
<section id="Ranking-based-on-New-Effect-(Refutatation-results)">
<h2>Ranking based on New Effect (Refutatation results)<a class="headerlink" href="#Ranking-based-on-New-Effect-(Refutatation-results)" title="Permalink to this headline"></a></h2>
<p>The ranking based on absolute value of deviations is : 1. Propensity Score Matching 2. Linear DR Learner 3. DML CATE Estimator 4. Linear Regression</p>
<p>Clearly, the observed unmodelled confounding error is not able to match the ranking based on the Original Estimate. It is not even able to tell that the clear winner amongst the methods according to the true value is DML CATE Estimator</p>
</section>
</section>
<section id="Unobserved-confounding-error">
<h1>Unobserved confounding error<a class="headerlink" href="#Unobserved-confounding-error" title="Permalink to this headline"></a></h1>
<p>For each estimator, we now simulate unobserved confounders and check its effect using dummy outcome refuter to check the unobserved confounding error for each estimator. That is, we run the refutation test for each estimator not only on the observed confounder, but also on an unobserved confounder that we simulate using the AddUnobservedCommonCause class and analyse whether there is a strong confounder that is unobserved (missing) and needs to be accounted for.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unobserved_confounding_error</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
    <span class="n">num_experiments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># 10</span>
    <span class="n">sample_sizes</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
    <span class="n">dgps</span><span class="o">=</span><span class="n">dgp_list</span><span class="p">,</span>
    <span class="n">estimators</span><span class="o">=</span><span class="n">estimator_tuples</span><span class="p">,</span>
    <span class="n">refuters</span><span class="o">=</span><span class="n">refuter_tuples</span><span class="p">,</span>
    <span class="n">simulate_unobserved_confounding</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">unobserved_confounding_error</span><span class="o">.</span><span class="n">experiment</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Running Experiment: Test_2


Running Experiment Number: 0


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.86310478],
       [  0.63617126],
       [  1.54125546],
       [  0.36444857],
       [  1.52982775],
       [ -0.21138205]]), &#39;confounder=&gt;outcome&#39;: array([[101.26124495],
       [ -1.26852531],
       [  0.35341168],
       [ -0.84248364],
       [  0.95100902],
       [  0.36682545]]), &#39;effect_modifier=&gt;outcome&#39;: array([[ 0.39936262],
       [-0.01333126]]), &#39;treatment=&gt;outcome&#39;: array([[-1.06632221]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.85055815]), &#39;confounder=&gt;outcome&#39;: array([0.60566836])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[2.27923558]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_1.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [69.45289924492648, 59.65614427468216, 69.87261498209274, 69.91778292377879, 69.3696459080966]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e9b340&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       847.010869
1      1115.554028
2      -652.860827
3      3573.656825
4      2019.004174
          ...
995   -3067.876703
996     -26.316378
997    1401.748338
998    3642.509611
999    1522.693667
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78464bf4f0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       848.295030
1      1116.007553
2      -653.767520
3      3573.819346
4      2020.656434
          ...
995   -3068.733216
996     -27.569824
997    1402.687602
998    3640.751149
999    1524.282645
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844ea6580&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       848.827321
1      1114.692594
2      -652.993869
3      3574.473209
4      2021.498866
          ...
995   -3069.516208
996     -27.447191
997    1400.393230
998    3641.705530
999    1521.367679
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844ea64c0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       850.184702
1      1116.600277
2      -654.106536
3      3574.203182
4      2019.585653
          ...
995   -3069.460486
996     -27.093251
997    1399.878590
998    3641.178713
999    1523.226421
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78f33b7be0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       847.692517
1      1115.669297
2      -653.541725
3      3574.746691
4      2023.297734
          ...
995   -3067.958667
996     -29.144169
997    1401.658150
998    3641.943067
999    1523.196842
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [5.177582619500304, 13.318551260534615, 13.715415099033248, 8.57777304991858, 0.03375900998331538]
p_value [0.22756070269496514, 0.1180749158767575, 0.055305331010443805, 0.1536542149055612, 0.47035651109280086]
true value 2.2792355759571015


Running Experiment Number: 1


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[ 1.01722302e+02],
       [ 1.10808557e+00],
       [ 1.58153420e+00],
       [-7.64291217e-01],
       [-4.57052462e-02],
       [-6.93466210e-01]]), &#39;confounder=&gt;outcome&#39;: array([[ 1.00379518e+02],
       [ 2.03609745e+00],
       [ 3.24682914e-01],
       [ 2.66915082e-01],
       [-7.09978040e-02],
       [-2.30744753e-02]]), &#39;effect_modifier=&gt;outcome&#39;: array([[ 0.26950554],
       [-2.03157144]]), &#39;treatment=&gt;outcome&#39;: array([[2.27923558]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.13693167]), &#39;confounder=&gt;outcome&#39;: array([-0.77767318])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.68164211]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_11.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [73.6594227422863, 69.8572112951081, 73.78443606335033, 69.97246805751057, 73.50498796506194]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       847.692517
1      1115.669297
2      -653.541725
3      3574.746691
4      2023.297734
          ...
995   -3067.958667
996     -29.144169
997    1401.658150
998    3641.943067
999    1523.196842
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f784516b460&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       769.945277
1      -603.650051
2      1331.862689
3      -154.406381
4      -357.739470
          ...
995    -677.825909
996   -1202.783341
997   -3535.058913
998      20.317808
999   -1027.464141
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7845061e50&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       767.264192
1      -600.282738
2      1332.889102
3      -158.207836
4      -357.260839
          ...
995    -677.597834
996   -1202.817426
997   -3535.311615
998      21.638115
999   -1028.848049
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e9b2b0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       767.482643
1      -602.036931
2      1332.426799
3      -156.939681
4      -355.847725
          ...
995    -679.480000
996   -1202.379028
997   -3535.389295
998      21.027223
999   -1028.989188
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844f24580&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       768.210030
1      -601.918279
2      1331.690219
3      -155.887049
4      -358.387511
          ...
995    -676.923132
996   -1202.257987
997   -3536.172219
998      20.177658
999   -1029.067347
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7845077e50&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       769.191459
1      -601.500693
2      1333.719632
3      -156.181997
4      -356.733817
          ...
995    -677.748759
996   -1203.745501
997   -3535.518020
998      20.794050
999   -1030.109689
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [11.80666353445712, 6.1464542384494445, 10.502480469888132, 5.47990398090776, 5.517053919788362]
p_value [0.01810931092826943, 0.2866388760014795, 0.006058966343111975, 0.35137931521298665, 0.2689575728408772]
true value 0.6816421133821597


Running Experiment Number: 2


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[99.55275304],
       [-0.2372805 ],
       [ 1.66520744],
       [-0.5967259 ],
       [ 0.11037351],
       [-2.23210792]]), &#39;confounder=&gt;outcome&#39;: array([[ 1.00229340e+02],
       [-2.11482983e-01],
       [ 1.73210819e+00],
       [-2.96950830e-01],
       [ 6.82337252e-01],
       [ 4.96675472e-02]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.7416291 ],
       [ 0.69314974]]), &#39;treatment=&gt;outcome&#39;: array([[0.68164211]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-1.28984879]), &#39;confounder=&gt;outcome&#39;: array([-0.44262687])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[1.54056665]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_22.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_22.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [60.63597333836037, 58.89582464203396, 59.53649046027437, 51.101651905371604, 61.1117330071961]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       769.191459
1      -601.500693
2      1333.719632
3      -156.181997
4      -356.733817
          ...
995    -677.748759
996   -1203.745501
997   -3535.518020
998      20.794050
999   -1030.109689
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78450f7670&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1679.331637
1     -6391.809754
2      1445.113244
3     -2615.576921
4     -1987.804197
          ...
995    -727.117891
996    -346.007549
997   -1191.271323
998    3316.810016
999    1816.320122
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e4d790&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1678.992807
1     -6391.911162
2      1445.242970
3     -2614.926345
4     -1990.678041
          ...
995    -730.732334
996    -347.386011
997   -1191.824639
998    3318.882513
999    1815.547920
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78452a4820&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1678.777479
1     -6392.282807
2      1444.343508
3     -2615.566299
4     -1989.923663
          ...
995    -730.125614
996    -347.838445
997   -1191.236657
998    3317.076209
999    1816.481509
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e06b20&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1678.764800
1     -6391.133382
2      1445.141744
3     -2615.223945
4     -1990.662511
          ...
995    -729.607781
996    -348.815043
997   -1190.563498
998    3317.601622
999    1816.136936
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78464034f0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1677.959389
1     -6392.336283
2      1445.117022
3     -2612.428756
4     -1989.782866
          ...
995    -731.187433
996    -348.416257
997   -1189.324909
998    3320.094655
999    1816.158870
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [3.2119490931462757, -10.229580895162286, -1.7022953091165385, 1.6417730696792538, 5.007075678039337]
p_value [0.32800297478865553, 0.07587168172086867, 0.3735368139858659, 0.4634864760942206, 0.16150612986792123]
true value 1.5405666535717248


Running Experiment Number: 3


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.80434156],
       [ -1.23810712],
       [ -0.30196104],
       [ -1.90823588],
       [ -0.51855561],
       [ -1.02854147]]), &#39;confounder=&gt;outcome&#39;: array([[101.56902979],
       [ -1.62496032],
       [ -1.00668056],
       [ -2.26182315],
       [  1.46967279],
       [ -0.51909446]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.02276864],
       [-0.69804865]]), &#39;treatment=&gt;outcome&#39;: array([[1.54056665]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([0.88005558]), &#39;confounder=&gt;outcome&#39;: array([2.33087689])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.18013667]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_33.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_33.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [72.96632217627543, 77.01832764129364, 72.63206501948798, 55.40640517560925, 72.99953631091002]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -1677.959389
1     -6392.336283
2      1445.117022
3     -2612.428756
4     -1989.782866
          ...
995    -731.187433
996    -348.416257
997   -1189.324909
998    3320.094655
999    1816.158870
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844f7a790&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1445.214685
1      2551.433363
2     -1072.226098
3     -1283.604030
4      1010.200999
          ...
995    -536.612811
996   -1041.143638
997   -1479.608271
998    1503.724186
999   -1777.499146
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7845230af0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1443.786200
1      2550.034835
2     -1072.052043
3     -1284.082568
4      1010.424132
          ...
995    -537.015180
996   -1040.962452
997   -1477.789830
998    1503.737576
999   -1774.824401
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844ad5f40&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1443.018424
1      2550.815602
2     -1072.156715
3     -1282.652793
4      1010.810872
          ...
995    -536.476092
996   -1042.030486
997   -1480.245334
998    1501.723954
999   -1774.015913
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78464224f0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1444.643537
1      2549.808142
2     -1070.413357
3     -1283.478251
4      1009.949483
          ...
995    -538.214326
996   -1040.556420
997   -1479.110709
998    1501.436098
999   -1776.159935
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78464be6d0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1445.316569
1      2548.115777
2     -1071.595363
3     -1284.423488
4      1010.254665
          ...
995    -537.499997
996   -1041.647662
997   -1478.906274
998    1503.641338
999   -1776.633488
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [5.206917530569817, 16.59946581683773, 5.477602504114498, 4.795836083890727, 3.161647962223264]
p_value [0.25771930091294515, 0.09222203477110169, 0.24708434627546627, 0.2337826345609687, 0.24420277711069083]
true value 0.1801366675658666


Running Experiment Number: 4


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.02441455],
       [ -0.14867504],
       [  0.18239508],
       [ -0.83541789],
       [ -0.49153505],
       [  0.88398599]]), &#39;confounder=&gt;outcome&#39;: array([[100.22822138],
       [ -1.37686658],
       [ -1.2156416 ],
       [  0.62802725],
       [  1.90209419],
       [  0.74871392]]), &#39;effect_modifier=&gt;outcome&#39;: array([[0.46207525],
       [2.26029927]]), &#39;treatment=&gt;outcome&#39;: array([[0.18013667]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.50310079]), &#39;confounder=&gt;outcome&#39;: array([-0.72576754])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.47209679]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_42.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_42.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [62.07915533945592, 62.34625395469203, 58.93426120057349, 59.73763602959992, 62.37682578198588]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0      1445.316569
1      2548.115777
2     -1071.595363
3     -1284.423488
4      1010.254665
          ...
995    -537.499997
996   -1041.647662
997   -1478.906274
998    1503.641338
999   -1776.633488
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b0d5e0&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2950.639787
1     -2793.857547
2       -43.875373
3      -593.634895
4      2239.467624
          ...
995    1110.477469
996     245.864174
997     -83.688148
998   -2397.476431
999   -1768.443962
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78451f0d90&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2950.179693
1     -2792.392675
2       -42.760611
3      -595.483474
4      2241.279212
          ...
995    1111.989797
996     242.734680
997     -82.809465
998   -2396.627825
999   -1768.860661
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844f7ad60&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2951.178228
1     -2793.714123
2       -44.577904
3      -591.210741
4      2239.832888
          ...
995    1113.970089
996     243.856464
997     -84.621971
998   -2396.928930
999   -1768.742583
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78451f0610&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2948.648888
1     -2793.933547
2       -45.568897
3      -593.561847
4      2240.044699
          ...
995    1111.337025
996     242.710490
997     -83.058949
998   -2397.343514
999   -1770.169083
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78451f0d90&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2948.017812
1     -2793.828133
2       -45.294800
3      -592.219819
4      2239.151804
          ...
995    1111.144327
996     243.964788
997     -84.246345
998   -2397.406576
999   -1769.093719
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [21.00404977767471, 19.107276634696827, 11.970890851746507, 18.521416652474066, 18.382113672067938]
p_value [0.007699518014915488, 0.02498480155215618, 0.003982846065882695, 0.07287469650070198, 0.0013557397793021297]
true value -0.47209679203476057


Running Experiment Number: 5


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[98.52716637],
       [ 0.27589015],
       [-0.80473151],
       [-0.50047851],
       [-0.32305169],
       [ 2.42572915]]), &#39;confounder=&gt;outcome&#39;: array([[101.38868177],
       [  1.78403018],
       [  0.7401208 ],
       [ -1.65142206],
       [ -0.94168852],
       [ -2.09190395]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-1.04076741],
       [ 1.67862315]]), &#39;treatment=&gt;outcome&#39;: array([[-0.47209679]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-0.29052051]), &#39;confounder=&gt;outcome&#39;: array([0.63600415])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.37168705]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_52.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_52.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [65.09963645911861, 67.10884146355691, 65.52443477990583, 61.098204493894634, 64.63635698831911]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2948.017812
1     -2793.828133
2       -45.294800
3      -592.219819
4      2239.151804
          ...
995    1111.144327
996     243.964788
997     -84.246345
998   -2397.406576
999   -1769.093719
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78451d2d30&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       232.261027
1      -659.209603
2     -2012.341404
3      -698.687863
4      1003.860425
          ...
995   -1631.287870
996    -117.990716
997     206.389848
998    1922.899646
999   -2192.661154
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b44d90&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       232.610671
1      -658.514125
2     -2012.381657
3      -697.796887
4      1002.571868
          ...
995   -1631.459185
996    -117.161218
997     207.545578
998    1923.464145
999   -2191.355552
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b447c0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       231.811825
1      -656.553703
2     -2012.126558
3      -697.065994
4      1002.115759
          ...
995   -1630.821804
996    -116.543747
997     205.359759
998    1923.383932
999   -2190.966881
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b44ca0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       232.163312
1      -657.892831
2     -2013.554331
3      -697.308391
4      1004.565032
          ...
995   -1630.421485
996    -118.435595
997     206.358223
998    1920.642511
999   -2192.728283
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7846698130&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       231.522152
1      -659.670876
2     -2010.473441
3      -697.972934
4      1002.947202
          ...
995   -1631.990360
996    -116.691977
997     205.203280
998    1922.020861
999   -2192.925812
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [8.951535663560685, 11.63671314309768, -0.20996917782305458, 2.052661969333459, -2.025354195219851]
p_value [0.05308748100532683, 0.1816867993976392, 0.39834093389124237, 0.42812695707518544, 0.38549791841106507]
true value 0.37168705353141435


Running Experiment Number: 6


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[99.78498965],
       [-0.80652592],
       [-0.27500707],
       [-0.39205656],
       [-1.24455266],
       [ 1.07678165]]), &#39;confounder=&gt;outcome&#39;: array([[100.64544825],
       [ -1.00078907],
       [  0.38709262],
       [ -0.59585189],
       [ -0.9791369 ],
       [  1.65303827]]), &#39;effect_modifier=&gt;outcome&#39;: array([[0.95788336],
       [1.64839326]]), &#39;treatment=&gt;outcome&#39;: array([[0.37168705]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-1.32096481]), &#39;confounder=&gt;outcome&#39;: array([0.69778585])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[-0.51208034]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_63.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_63.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [59.63656681144565, 70.80923058283928, 59.54545564189914, 57.89543165936835, 59.40085360315823]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       231.522152
1      -659.670876
2     -2010.473441
3      -697.972934
4      1002.947202
          ...
995   -1631.990360
996    -116.691977
997     205.203280
998    1922.020861
999   -2192.925812
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7845307430&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2028.227391
1       -74.808492
2      1946.513093
3      -360.653073
4        52.300700
          ...
995     918.108589
996    3706.455962
997     653.885257
998    -639.341511
999    -253.761561
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7846601700&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2025.227991
1       -73.415747
2      1945.860976
3      -359.389878
4        51.464903
          ...
995     918.976522
996    3706.234552
997     654.279590
998    -640.828986
999    -254.668811
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78450c7190&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2025.125558
1       -76.752282
2      1945.745301
3      -358.811315
4        51.959758
          ...
995     917.878679
996    3705.615521
997     653.618231
998    -640.155929
999    -252.100218
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7846661cd0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2027.269803
1       -75.473798
2      1944.729787
3      -358.761906
4        52.964028
          ...
995     918.452860
996    3707.880625
997     651.950691
998    -640.559176
999    -253.266852
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844da6c70&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2025.673563
1       -74.407769
2      1945.793450
3      -359.196304
4        53.267029
          ...
995     918.433769
996    3704.461470
997     655.029128
998    -639.899984
999    -253.873178
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [6.862897571514847, 17.163569063224106, 9.952760213657475, 7.83816658115268, 4.009809258793333]
p_value [0.1339306336423698, 0.18863397292620782, 0.018427053531901577, 0.2501901040931147, 0.35311164057994693]
true value -0.5120803369521811


Running Experiment Number: 7


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[103.09086966],
       [  1.09720495],
       [  0.38490769],
       [  0.99172238],
       [ -1.05010159],
       [  1.59125818]]), &#39;confounder=&gt;outcome&#39;: array([[99.64472492],
       [ 1.33003461],
       [ 0.84881146],
       [ 1.68093539],
       [-0.85408497],
       [-0.74490785]]), &#39;effect_modifier=&gt;outcome&#39;: array([[-0.36335923],
       [-0.71946202]]), &#39;treatment=&gt;outcome&#39;: array([[-0.51208034]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-1.01360762]), &#39;confounder=&gt;outcome&#39;: array([0.57614152])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[1.27296249]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_72.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_72.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [67.11989437062482, 69.94894707155635, 66.1508446867158, 58.651596044447714, 67.26664240787976]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0     -2025.673563
1       -74.407769
2      1945.793450
3      -359.196304
4        53.267029
          ...
995     918.433769
996    3704.461470
997     655.029128
998    -639.899984
999    -253.873178
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844d989d0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -67.182761
1       268.162210
2      -270.176563
3      -751.297318
4      -320.989392
          ...
995     735.229412
996    1772.579039
997   -1117.972707
998     195.994724
999     162.815939
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e46df0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -67.892845
1       268.672472
2      -271.957159
3      -752.596420
4      -321.638210
          ...
995     735.409247
996    1772.913890
997   -1120.068624
998     198.038279
999     165.647304
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78463c6f10&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -67.407444
1       267.984336
2      -272.970027
3      -752.195390
4      -321.792707
          ...
995     737.104325
996    1772.870800
997   -1118.950189
998     195.836196
999     164.024674
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f78451d2640&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -68.186077
1       269.797458
2      -271.958813
3      -750.117194
4      -321.869064
          ...
995     737.006780
996    1774.172336
997   -1118.929424
998     195.156805
999     164.596438
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f784657cb20&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -68.517452
1       270.625868
2      -271.705630
3      -753.197874
4      -321.805250
          ...
995     735.507720
996    1772.973877
997   -1118.458393
998     196.142527
999     165.328683
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [8.155427096489902, 11.810335290129952, 9.30512886314582, 19.19213769227935, 8.596045407696176]
p_value [0.16972896819054706, 0.10745983182955332, 0.0036975877657847212, 0.12828986570371204, 0.12558394902398662]
true value 1.272962485151482


Running Experiment Number: 8


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[101.87290033],
       [  1.1871212 ],
       [ -0.34395076],
       [  0.78820313],
       [  0.4222783 ],
       [  0.1943532 ]]), &#39;confounder=&gt;outcome&#39;: array([[99.53970352],
       [-0.51382427],
       [ 0.77046477],
       [-1.52233512],
       [ 0.48575287],
       [ 1.20121431]]), &#39;effect_modifier=&gt;outcome&#39;: array([[0.00654122],
       [0.18445018]]), &#39;treatment=&gt;outcome&#39;: array([[1.27296249]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([1.62877678]), &#39;confounder=&gt;outcome&#39;: array([0.94632659])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[1.45499357]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_82.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_82.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [72.18240395332244, 66.95877851075792, 73.27576601648781, 71.24637190372287, 72.83801974133483]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       -68.517452
1       270.625868
2      -271.705630
3      -753.197874
4      -321.805250
          ...
995     735.507720
996    1772.973877
997   -1118.458393
998     196.142527
999     165.328683
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844d9e700&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       474.128250
1      -523.763515
2     -1831.847923
3     -2090.287173
4     -4325.640849
          ...
995     809.373179
996   -2494.894733
997    -282.813273
998     175.595063
999   -2222.633875
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844fc9070&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       476.358134
1      -523.836173
2     -1830.924611
3     -2090.185685
4     -4326.587495
          ...
995     808.866623
996   -2492.599855
997    -281.553015
998     175.691935
999   -2220.785611
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844fc9eb0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       474.668329
1      -525.672309
2     -1828.822340
3     -2089.825114
4     -4326.191384
          ...
995     808.526573
996   -2492.738722
997    -283.697566
998     174.330901
999   -2221.522011
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f784daa2190&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       474.181604
1      -525.810514
2     -1829.828574
3     -2090.905525
4     -4327.416457
          ...
995     807.935788
996   -2491.494644
997    -283.911299
998     177.112092
999   -2222.564931
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b590a0&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       476.062360
1      -523.875707
2     -1829.045284
3     -2090.516702
4     -4325.104966
          ...
995     810.198855
996   -2490.440372
997    -282.703027
998     174.952825
999   -2220.253911
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [9.56418805087097, 17.71782959958133, 11.289658617556121, 14.112789927087764, 7.923498361766749]
p_value [0.09066180569377158, 0.1199859947256311, 0.04416894013720861, 0.08946411887201594, 0.24614961768402527]
true value 1.4549935695266385


Running Experiment Number: 9


Current Sample Size: 1000


The current DGP:

        Linear Data Generating Process
        -------------------------------

        treatment:[&#39;t1&#39;]
        outcome:[&#39;y&#39;]
        confounder: [&#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;]
        effect_modifier: [&#39;x1&#39;, &#39;x2&#39;]
        weights: {&#39;confounder=&gt;treatment&#39;: array([[100.46901513],
       [ -0.18360882],
       [  0.23235846],
       [ -0.37167707],
       [  0.71272892],
       [ -0.98904922]]), &#39;confounder=&gt;outcome&#39;: array([[1.00025121e+02],
       [6.82656712e-01],
       [5.61406596e-01],
       [6.41511118e-01],
       [6.58815996e-02],
       [1.02249640e+00]]), &#39;effect_modifier=&gt;outcome&#39;: array([[ 1.37853993],
       [-0.59741509]]), &#39;treatment=&gt;outcome&#39;: array([[1.45499357]])}
        bias: {&#39;confounder=&gt;treatment&#39;: array([-1.38406517]), &#39;confounder=&gt;outcome&#39;: array([-1.79817635])}
        seed: None
        treatment_is_binary: True
        percentile: 0.9

printing data shape
(1000, 10)
[0.47461769]
check
printing length of confounder list: 2
printing confounder list: [&#39;w2&#39;, &#39;w3&#39;]
data columns
data columns Index([&#39;x1&#39;, &#39;x2&#39;, &#39;w1&#39;, &#39;w2&#39;, &#39;w3&#39;, &#39;w4&#39;, &#39;w5&#39;, &#39;w6&#39;, &#39;t1&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_24_92.png" src="../_images/example_notebooks_dowhy_ranking_methods_24_92.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
identified_estimand: Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|w3,w2))
d[t₁]
Estimand assumption 1, Unconfoundedness: If U→{t1} and U→y then P(y|t1,w3,w2,U) = P(y|t1,w3,w2)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!



Running the estimators:

The current estimator: Estimator(name=&#39;backdoor.linear_regression&#39;, params=None)
estimator.params None
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_matching&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.propensity_score_weighting&#39;, params={&#39;init_params&#39;: {}})
estimator.params {&#39;init_params&#39;: {}}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dml.DML&#39;, params={&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_y&#39;: GradientBoostingRegressor(), &#39;model_t&#39;: GradientBoostingRegressor(), &#39;model_final&#39;: LassoCV(fit_intercept=False), &#39;featurizer&#39;: PolynomialFeatures(degree=1)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dml.DML&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
The current estimator: Estimator(name=&#39;backdoor.econml.dr.LinearDRLearner&#39;, params={&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;})
estimator.params {&#39;init_params&#39;: {&#39;model_propensity&#39;: LogisticRegressionCV(cv=3)}, &#39;fit_params&#39;: {}, &#39;_econml_methodname&#39;: &#39;econml.dr.LinearDRLearner&#39;}
printing estimate&#39;s type
&lt;class &#39;dowhy.causal_estimator.CausalEstimate&#39;&gt;
estimate_values [59.57001117751645, 62.36679740611476, 59.36853358399933, 52.7687281690154, 59.450742991982125]


Running the refuters:

The current refuter: Refuter(name=&#39;dummy_outcome_refuter&#39;, params={&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       476.062360
1      -523.875707
2     -1829.045284
3     -2090.516702
4     -4325.104966
          ...
995     810.198855
996   -2490.440372
997    -282.703027
998     174.952825
999   -2220.253911
Length: 1000, dtype: float64})
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844e6ab50&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       699.750736
1     -1972.116879
2      3026.278949
3       356.905837
4      -126.929640
          ...
995    -905.601593
996    -200.848838
997   -2420.509128
998   -3178.227237
999   -1205.856601
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
divide by zero encountered in double_scalars
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7846495670&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       700.881211
1     -1973.647072
2      3025.606868
3       356.826885
4      -128.510159
          ...
995    -908.011548
996    -200.375592
997   -2421.695931
998   -3174.878682
999   -1206.877803
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844bb2100&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       700.958417
1     -1974.083818
2      3024.975531
3       353.863882
4      -127.392611
          ...
995    -908.647898
996    -200.687901
997   -2419.406275
998   -3177.577613
999   -1204.413337
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7846716e20&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       702.248478
1     -1972.083758
2      3024.649476
3       355.527110
4      -128.071789
          ...
995    -906.806415
996    -200.529223
997   -2421.762174
998   -3175.736155
999   -1206.705215
Length: 1000, dtype: float64}
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
********%%%%%%%%%$$$$$&amp;&amp;^**^^^^*^*^*
add_unobserved_confounder &lt;dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause object at 0x7f7844b4ef70&gt;
refuter.params {&#39;num_simulations&#39;: 5, &#39;transformation_list&#39;: [(&#39;random_forest&#39;, {&#39;n_estimators&#39;: 100, &#39;max_depth&#39;: 6})], &#39;true_causal_effect&#39;: &lt;function &lt;lambda&gt; at 0x7f78f3382430&gt;, &#39;unobserved_confounder_values&#39;: 0       701.017371
1     -1972.230760
2      3025.172939
3       355.642614
4      -128.395831
          ...
995    -907.788171
996    -201.047542
997   -2420.329556
998   -3177.997074
999   -1205.376357
Length: 1000, dtype: float64}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
printing refute&#39;s type
&lt;class &#39;list&#39;&gt;
estimated effect [0.5, 0.5, 0.5, 0.5, 0.5]
new_effect [3.4860565810808595, 9.84833843498345, 7.817982669620337, 4.115959092616528, 9.035813014613554]
p_value [0.3217877560404976, 0.12392295503371825, 0.2134623272978068, 0.4047645806973455, 0.12624814643298032]
true value 0.4746176900208068


Completed all experiments. Saving the data...
Data has been saved in  results/Test_2_2022-03-02_data.csv
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Co-variance matrix is underdetermined. Inference will be invalid!
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##This plot shows the Mean Absolute Error of the Orginal Estimate from the true value and of the New Effect from</span>
<span class="c1">#the expected value for each estimator.</span>
<span class="n">plot_MAEs</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_25_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_25_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Printing MAE of various estimates:
ORIGINAL_ESTIMATE:backdoor.propensity_score_matching 65.7694692162915
ORIGINAL_ESTIMATE:backdoor.econml.dr.LinearDRLearner 65.56836800262045
ORIGINAL_ESTIMATE:backdoor.linear_regression 65.51306209336121
ORIGINAL_ESTIMATE:backdoor.econml.dml.DML 60.05246116825989
dummy_outcome_refuter:backdoor.propensity_score_matching:NEW_EFFECT 12.938758300412061
dummy_outcome_refuter:backdoor.econml.dml.DML:NEW_EFFECT 7.9056753419619925
dummy_outcome_refuter:backdoor.propensity_score_weighting:NEW_EFFECT 7.8497026510187755
dummy_outcome_refuter:backdoor.linear_regression:NEW_EFFECT 7.615560283914524
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:NEW_EFFECT 6.165483303948203
dummy_outcome_refuter:backdoor.propensity_score_matching:P_VALUE 0.834777462281575
dummy_outcome_refuter:backdoor.propensity_score_weighting:P_VALUE 0.8107976708723845
dummy_outcome_refuter:backdoor.linear_regression:P_VALUE 0.8070156055790599
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:P_VALUE 0.7721737644437987
dummy_outcome_refuter:backdoor.econml.dml.DML:P_VALUE 0.7530307316243703
dummy_outcome_refuter:backdoor.linear_regression:ESTIMATED_EFFECT 0.7187136115457959
dummy_outcome_refuter:backdoor.propensity_score_matching:ESTIMATED_EFFECT 0.7187136115457959
dummy_outcome_refuter:backdoor.propensity_score_weighting:ESTIMATED_EFFECT 0.7187136115457959
dummy_outcome_refuter:backdoor.econml.dml.DML:ESTIMATED_EFFECT 0.7187136115457959
dummy_outcome_refuter:backdoor.econml.dr.LinearDRLearner:ESTIMATED_EFFECT 0.7187136115457959
</pre></div></div>
</div>
<section id="id1">
<h2>Ranking based on Original Estimate<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<p>The Original Estimate is calculated in the presence of the True Value (that is, the ground truth). However in many real life datasets, the ground truth may not be known. Hence, we want the ranking produced by our refutation tests to be in coherence with that obtained from the Original Estimates. According to the Original Estimate values, the ranking of the estimators should be as follows (the method with the least MAE should get the best rank): 1. DMLCateEstimator 2. Propensity Score Matching 3.
LinearRegression 4. LinearDRLearner</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#This plot shows the deviation of the original estimate, the new effect and the estimated effect from the true value</span>
<span class="n">refuter</span> <span class="o">=</span> <span class="s1">&#39;dummy_outcome_refuter&#39;</span>
<span class="n">deviation_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimator_list</span><span class="p">:</span>
    <span class="n">plot_estimators_and_refuters</span><span class="p">(</span><span class="n">refuter</span><span class="p">,</span> <span class="n">estimator</span><span class="p">)</span>
    <span class="n">avg_deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">res</span><span class="p">[</span><span class="n">refuter</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">estimator</span><span class="o">+</span><span class="s1">&#39;:NEW_EFFECT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
    <span class="n">deviation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_deviation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_28_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_28_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
83.42726751886549
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_28_2.png" src="../_images/example_notebooks_dowhy_ranking_methods_28_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
113.11895258637284
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_28_4.png" src="../_images/example_notebooks_dowhy_ranking_methods_28_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
86.32841809934015
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_28_6.png" src="../_images/example_notebooks_dowhy_ranking_methods_28_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
59.641462089752174
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deviations</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deviation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_ranking_methods_29_0.png" src="../_images/example_notebooks_dowhy_ranking_methods_29_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
backdoor.linear_regression: 83.42726751886549
backdoor.propensity_score_matching: 113.11895258637284
backdoor.econml.dml.DML: 86.32841809934015
backdoor.econml.dr.LinearDRLearner: 59.641462089752174
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">,</span> <span class="n">deviation_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;backdoor.propensity_score_matching&#39;: 113.11895258637284,
 &#39;backdoor.econml.dml.DML&#39;: 86.32841809934015,
 &#39;backdoor.linear_regression&#39;: 83.42726751886549,
 &#39;backdoor.econml.dr.LinearDRLearner&#39;: 59.641462089752174}
</pre></div></div>
</div>
</section>
<section id="id2">
<h2>Ranking based on New Effect (Refutatation results)<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p>The ranking based on absolute value of deviations is : 1. DML 2. Linear DR Learner 3. Propensity Score Matching 4. Linear Regression</p>
<section id="We-can-see-that-this-ranking-produces-the-same-top-ranked-estimator-as-the-one-based-on-Original-Estimate.-Thus-ranking-based-on-the-unobserved-confounding-error-solves-the-problem-and-gives-us-a-close-to-correct-ranking-amongst-methods.">
<h3>We can see that this ranking produces the same top-ranked estimator as the one based on Original Estimate. Thus ranking based on the unobserved confounding error solves the problem and gives us a close-to-correct ranking amongst methods.<a class="headerlink" href="#We-can-see-that-this-ranking-produces-the-same-top-ranked-estimator-as-the-one-based-on-Original-Estimate.-Thus-ranking-based-on-the-unobserved-confounding-error-solves-the-problem-and-gives-us-a-close-to-correct-ranking-amongst-methods." title="Permalink to this headline"></a></h3>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>